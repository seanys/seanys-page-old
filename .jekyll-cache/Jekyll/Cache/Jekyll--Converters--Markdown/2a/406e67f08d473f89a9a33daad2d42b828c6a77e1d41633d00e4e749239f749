I"Ø<blockquote>
  <p>âœ…  å·²ç»æ•´ç†å¥½</p>

  <p>ğŸ’¤  å¤§éƒ¨åˆ†æ•´ç†å¥½äº†ä½†æ˜¯æ²¡ç†è§£</p>

  <p>ğŸ†˜  è¿˜æœ‰ä¸€éƒ¨åˆ†éœ€è¦æ•´ç†</p>

  <p>â˜£ï¸  éœ€è¦æ•´ç†</p>
</blockquote>

<p>å¤‡æ³¨ï¼šéƒ¨åˆ†ç®—æ³•åœ¨å¤šä¸ªåˆ†ç±»ä¸­å‡æœ‰åº”ç”¨ï¼Œå¯èƒ½åªå†™åœ¨ä¸€ä¸ªåˆ†ç±»ä¸­ï¼Œæˆ–è€…æ”¾åœ¨äº†å›å½’æ¨¡å‹ä¸­</p>

<h2 id="æœºå™¨å­¦ä¹ ä¸æ•°æ®æŒ–æ˜">æœºå™¨å­¦ä¹ ä¸æ•°æ®æŒ–æ˜</h2>

<h3 id="-å†³ç­–æ ‘decision-tree">âœ… å†³ç­–æ ‘ï¼ˆDecision Treeï¼‰</h3>

<h4 id="-å‰è¨€">âœ… å‰è¨€</h4>

<p><strong>åŸºæœ¬æ¦‚å¿µ</strong></p>

<p>ï¼ˆ1ï¼‰æ ¹ç»“ç‚¹(Root Node)ï¼šå®ƒè¡¨ç¤ºæ•´ä¸ªæ ·æœ¬é›†åˆï¼Œå¹¶ä¸”è¯¥èŠ‚ç‚¹å¯ä»¥è¿›ä¸€æ­¥åˆ’åˆ†æˆä¸¤ä¸ªæˆ–å¤šä¸ªå­é›†ã€‚</p>

<p>ï¼ˆ2ï¼‰æ‹†åˆ†(Splitting)ï¼šè¡¨ç¤ºå°†ä¸€ä¸ªç»“ç‚¹æ‹†åˆ†æˆå¤šä¸ªå­é›†çš„è¿‡ç¨‹ã€‚</p>

<p>ï¼ˆ3ï¼‰å†³ç­–ç»“ç‚¹(Decision Node)ï¼šå½“ä¸€ä¸ªå­ç»“ç‚¹è¿›ä¸€æ­¥è¢«æ‹†åˆ†æˆå¤šä¸ªå­èŠ‚ç‚¹æ—¶ï¼Œè¿™ä¸ªå­èŠ‚ç‚¹å°±å«åšå†³ç­–ç»“ç‚¹ã€‚</p>

<p>ï¼ˆ4ï¼‰å¶å­ç»“ç‚¹(Leaf/Terminal Node)ï¼šæ— æ³•å†æ‹†åˆ†çš„ç»“ç‚¹è¢«ç§°ä¸ºå¶å­ç»“ç‚¹ã€‚</p>

<p>ï¼ˆ5ï¼‰å‰ªæ(Pruning)ï¼šç§»é™¤å†³ç­–æ ‘ä¸­å­ç»“ç‚¹çš„è¿‡ç¨‹å°±å«åšå‰ªæï¼Œè·Ÿæ‹†åˆ†è¿‡ç¨‹ç›¸åã€‚</p>

<p>ï¼ˆ6ï¼‰åˆ†æ”¯/å­æ ‘(Branch/Sub-Tree)ï¼šä¸€æ£µå†³ç­–æ ‘çš„ä¸€éƒ¨åˆ†å°±å«åšåˆ†æ”¯æˆ–å­æ ‘ã€‚</p>

<p>ï¼ˆ7ï¼‰çˆ¶ç»“ç‚¹å’Œå­ç»“ç‚¹(Paren and Child Node)ï¼šä¸€ä¸ªç»“ç‚¹è¢«æ‹†åˆ†æˆå¤šä¸ªå­èŠ‚ç‚¹ï¼Œè¿™ä¸ªç»“ç‚¹å°±å«åšçˆ¶èŠ‚ç‚¹ï¼›å…¶æ‹†åˆ†åçš„å­ç»“ç‚¹ä¹Ÿå«åšå­ç»“ç‚¹ã€‚</p>

<p><strong>åˆ†ç±»</strong></p>

<ul>
  <li>ç¦»æ•£æ€§å†³ç­–æ ‘ï¼šç¦»æ•£æ€§å†³ç­–æ ‘ï¼Œå…¶ç›®æ ‡å˜é‡æ˜¯ç¦»æ•£çš„ï¼Œå¦‚æ€§åˆ«ï¼šç”·æˆ–å¥³ç­‰ï¼›</li>
  <li>è¿ç»­æ€§å†³ç­–æ ‘ï¼šè¿ç»­æ€§å†³ç­–æ ‘ï¼Œå…¶ç›®æ ‡å˜é‡æ˜¯è¿ç»­çš„ï¼Œå¦‚å·¥èµ„ã€ä»·æ ¼ã€å¹´é¾„ç­‰ï¼›</li>
</ul>

<p><img src="https://shuwoom.com/wp-content/uploads/2018/10/65e4301fe9e9a0f4e4d448a8f4181751.png" alt="img" /></p>

<p><strong>ç‰¹å¾é€‰æ‹©</strong></p>

<p>ç‰¹å¾é€‰æ‹©è¡¨ç¤ºä»ä¼—å¤šçš„ç‰¹å¾ä¸­é€‰æ‹©ä¸€ä¸ªç‰¹å¾ä½œä¸ºå½“å‰èŠ‚ç‚¹åˆ†è£‚çš„æ ‡å‡†ï¼Œå¦‚ä½•é€‰æ‹©ç‰¹å¾æœ‰ä¸åŒçš„é‡åŒ–è¯„ä¼°æ–¹æ³•ï¼Œä»è€Œè¡ç”Ÿå‡ºä¸åŒçš„å†³ç­–æ ‘ï¼Œå¦‚ID3ï¼ˆé€šè¿‡ä¿¡æ¯å¢ç›Šé€‰æ‹©ç‰¹å¾ï¼‰ã€C4.5ï¼ˆé€šè¿‡ä¿¡æ¯å¢ç›Šæ¯”é€‰æ‹©ç‰¹å¾ï¼‰ã€CARTï¼ˆé€šè¿‡GiniæŒ‡æ•°é€‰æ‹©ç‰¹å¾ï¼‰ç­‰ã€‚</p>

<p><strong>å†³ç­–æ ‘çš„ç”Ÿæˆ</strong></p>

<p>æ ¹æ®é€‰æ‹©çš„ç‰¹å¾è¯„ä¼°æ ‡å‡†ï¼Œä»ä¸Šè‡³ä¸‹é€’å½’åœ°ç”Ÿæˆå­èŠ‚ç‚¹ï¼Œç›´åˆ°æ•°æ®é›†ä¸å¯åˆ†åˆ™åœæ­¢å†³ç­–æ ‘åœæ­¢ç”Ÿé•¿ã€‚è¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯ä½¿ç”¨æ»¡è¶³åˆ’åˆ†å‡†åˆ™çš„ç‰¹å¾ä¸æ–­çš„å°†æ•°æ®é›†åˆ’åˆ†æˆçº¯åº¦æ›´é«˜ï¼Œä¸ç¡®å®šè¡Œæ›´å°çš„å­é›†çš„è¿‡ç¨‹ã€‚å¯¹äºå½“å‰æ•°æ®é›†çš„æ¯ä¸€æ¬¡åˆ’åˆ†ï¼Œéƒ½å¸Œæœ›æ ¹æ®æŸä¸ªç‰¹å¾åˆ’åˆ†ä¹‹åçš„å„ä¸ªå­é›†çš„çº¯åº¦æ›´é«˜ï¼Œä¸ç¡®å®šæ€§æ›´å°ã€‚</p>

<p><strong>å†³ç­–æ ‘çš„è£å‰ª</strong></p>

<p>å†³ç­–æ ‘å®¹æ˜“è¿‡æ‹Ÿåˆï¼Œä¸€èˆ¬éœ€è¦å‰ªææ¥ç¼©å°æ ‘ç»“æ„è§„æ¨¡ã€ç¼“è§£è¿‡æ‹Ÿåˆã€‚</p>

<p>å‚è€ƒèµ„æ–™ï¼šhttps://shuwoom.com/?p=1452</p>

<h4 id="-id3ç®—æ³•">âœ… ID3ç®—æ³•</h4>

<p>ç†µè¿™ä¸ªæ¦‚å¿µæœ€æ—©èµ·æºäºç‰©ç†å­¦ï¼Œåœ¨ç‰©ç†å­¦ä¸­æ˜¯ç”¨æ¥åº¦é‡ä¸€ä¸ªçƒ­åŠ›å­¦ç³»ç»Ÿçš„æ— åºç¨‹åº¦ï¼Œè€Œåœ¨ä¿¡æ¯å­¦é‡Œé¢ï¼Œç†µæ˜¯å¯¹ä¸ç¡®å®šæ€§çš„åº¦é‡ã€‚åœ¨1948å¹´ï¼Œé¦™å†œå¼•å…¥äº†ä¿¡æ¯ç†µï¼ˆinformation entropyï¼‰ï¼Œå°†å…¶å®šä¹‰ä¸ºç¦»æ•£éšæœºäº‹ä»¶å‡ºç°çš„æ¦‚ç‡ï¼Œä¸€ä¸ªç³»ç»Ÿè¶Šæ˜¯æœ‰åºï¼Œä¿¡æ¯ç†µå°±è¶Šä½ï¼Œåä¹‹ä¸€ä¸ªç³»ç»Ÿè¶Šæ˜¯æ··ä¹±ï¼Œå®ƒçš„ä¿¡æ¯ç†µå°±è¶Šé«˜ã€‚æ‰€ä»¥ä¿¡æ¯ç†µå¯ä»¥è¢«è®¤ä¸ºæ˜¯ç³»ç»Ÿæœ‰åºåŒ–ç¨‹åº¦çš„ä¸€ä¸ªåº¦é‡ã€‚</p>

<p><strong>æ¡ˆä¾‹</strong>ï¼šå¯¹äºæœ‰Kä¸ªç±»åˆ«çš„åˆ†ç±»é—®é¢˜æ¥è¯´ï¼Œå‡å®šæ ·æœ¬é›†åˆDä¸­ç¬¬ k ç±»æ ·æœ¬æ‰€å çš„æ¯”ä¾‹ä¸ºpkï¼ˆk=1,2,â€¦,Kï¼‰,åˆ™æ ·æœ¬é›†åˆDçš„ä¿¡æ¯ç†µå®šä¹‰ä¸º:</p>

<script type="math/tex; mode=display">Ent(D)=-\sum_{k=1}^KP_kÂ·log_2p_k</script>

<p><strong>ç®€å•æ¦‚æ‹¬</strong>ï¼šåˆ†å‰æ ‘ä¸Šçš„ç†µçš„åŠ æƒå¹³å‡å€¼</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span>
<span class="kn">import</span> <span class="nn">operator</span>

<span class="k">def</span> <span class="nf">calcShannonEnt</span><span class="p">(</span><span class="n">dataSet</span><span class="p">):</span>  <span class="c1"># è®¡ç®—æ•°æ®çš„ç†µ(entropy)
</span>    <span class="n">numEntries</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dataSet</span><span class="p">)</span>  <span class="c1"># æ•°æ®æ¡æ•°
</span>    <span class="n">labelCounts</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">featVec</span> <span class="ow">in</span> <span class="n">dataSet</span><span class="p">:</span>
        <span class="n">currentLabel</span><span class="o">=</span><span class="n">featVec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># æ¯è¡Œæ•°æ®çš„æœ€åä¸€ä¸ªå­—ï¼ˆç±»åˆ«ï¼‰
</span>        <span class="k">if</span> <span class="n">currentLabel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labelCounts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">labelCounts</span><span class="p">[</span><span class="n">currentLabel</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">labelCounts</span><span class="p">[</span><span class="n">currentLabel</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>  <span class="c1"># ç»Ÿè®¡æœ‰å¤šå°‘ä¸ªç±»ä»¥åŠæ¯ä¸ªç±»çš„æ•°é‡
</span>    <span class="n">shannonEnt</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">labelCounts</span><span class="p">:</span>
        <span class="n">prob</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">labelCounts</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="o">/</span><span class="n">numEntries</span> <span class="c1"># è®¡ç®—å•ä¸ªç±»çš„ç†µå€¼
</span>        <span class="n">shannonEnt</span><span class="o">-=</span><span class="n">prob</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># ç´¯åŠ æ¯ä¸ªç±»çš„ç†µå€¼
</span>    <span class="k">return</span> <span class="n">shannonEnt</span>

<span class="k">def</span> <span class="nf">createDataSet1</span><span class="p">():</span>    <span class="c1"># åˆ›é€ ç¤ºä¾‹æ•°æ®
</span>    <span class="n">dataSet</span> <span class="o">=</span> <span class="p">[[</span><span class="s">'é•¿'</span><span class="p">,</span> <span class="s">'ç²—'</span><span class="p">,</span> <span class="s">'ç”·'</span><span class="p">],</span>
               <span class="p">[</span><span class="s">'çŸ­'</span><span class="p">,</span> <span class="s">'ç²—'</span><span class="p">,</span> <span class="s">'ç”·'</span><span class="p">],</span>
               <span class="p">[</span><span class="s">'çŸ­'</span><span class="p">,</span> <span class="s">'ç²—'</span><span class="p">,</span> <span class="s">'ç”·'</span><span class="p">],</span>
               <span class="p">[</span><span class="s">'é•¿'</span><span class="p">,</span> <span class="s">'ç»†'</span><span class="p">,</span> <span class="s">'å¥³'</span><span class="p">],</span>
               <span class="p">[</span><span class="s">'çŸ­'</span><span class="p">,</span> <span class="s">'ç»†'</span><span class="p">,</span> <span class="s">'å¥³'</span><span class="p">],</span>
               <span class="p">[</span><span class="s">'çŸ­'</span><span class="p">,</span> <span class="s">'ç²—'</span><span class="p">,</span> <span class="s">'å¥³'</span><span class="p">],</span>
               <span class="p">[</span><span class="s">'é•¿'</span><span class="p">,</span> <span class="s">'ç²—'</span><span class="p">,</span> <span class="s">'å¥³'</span><span class="p">],</span>
               <span class="p">[</span><span class="s">'é•¿'</span><span class="p">,</span> <span class="s">'ç²—'</span><span class="p">,</span> <span class="s">'å¥³'</span><span class="p">]]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">'å¤´å‘'</span><span class="p">,</span><span class="s">'å£°éŸ³'</span><span class="p">]</span>  <span class="c1">#ä¸¤ä¸ªç‰¹å¾
</span>    <span class="k">return</span> <span class="n">dataSet</span><span class="p">,</span><span class="n">labels</span>

<span class="k">def</span> <span class="nf">splitDataSet</span><span class="p">(</span><span class="n">dataSet</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> <span class="c1"># æŒ‰æŸä¸ªç‰¹å¾åˆ†ç±»åçš„æ•°æ®
</span>    <span class="n">retDataSet</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">featVec</span> <span class="ow">in</span> <span class="n">dataSet</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">featVec</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">==</span><span class="n">value</span><span class="p">:</span>
            <span class="n">reducedFeatVec</span> <span class="o">=</span><span class="n">featVec</span><span class="p">[:</span><span class="n">axis</span><span class="p">]</span>
            <span class="n">reducedFeatVec</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">featVec</span><span class="p">[</span><span class="n">axis</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">retDataSet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reducedFeatVec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">retDataSet</span>

<span class="k">def</span> <span class="nf">chooseBestFeatureToSplit</span><span class="p">(</span><span class="n">dataSet</span><span class="p">):</span>  <span class="c1"># é€‰æ‹©æœ€ä¼˜çš„åˆ†ç±»ç‰¹å¾
</span>    <span class="n">numFeatures</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataSet</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">baseEntropy</span> <span class="o">=</span> <span class="n">calcShannonEnt</span><span class="p">(</span><span class="n">dataSet</span><span class="p">)</span>  <span class="c1"># åŸå§‹çš„ç†µ
</span>    <span class="n">bestInfoGain</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">bestFeature</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numFeatures</span><span class="p">):</span>
        <span class="n">featList</span> <span class="o">=</span> <span class="p">[</span><span class="n">example</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">dataSet</span><span class="p">]</span>
        <span class="n">uniqueVals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">featList</span><span class="p">)</span>
        <span class="n">newEntropy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">uniqueVals</span><span class="p">:</span>
            <span class="n">subDataSet</span> <span class="o">=</span> <span class="n">splitDataSet</span><span class="p">(</span><span class="n">dataSet</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
            <span class="n">prob</span> <span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">subDataSet</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataSet</span><span class="p">))</span>
            <span class="n">newEntropy</span> <span class="o">+=</span><span class="n">prob</span><span class="o">*</span><span class="n">calcShannonEnt</span><span class="p">(</span><span class="n">subDataSet</span><span class="p">)</span>  <span class="c1"># æŒ‰ç‰¹å¾åˆ†ç±»åçš„ç†µ
</span>        <span class="n">infoGain</span> <span class="o">=</span> <span class="n">baseEntropy</span> <span class="o">-</span> <span class="n">newEntropy</span>  <span class="c1"># åŸå§‹ç†µä¸æŒ‰ç‰¹å¾åˆ†ç±»åçš„ç†µçš„å·®å€¼
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">infoGain</span><span class="o">&gt;</span><span class="n">bestInfoGain</span><span class="p">):</span>   <span class="c1"># è‹¥æŒ‰æŸç‰¹å¾åˆ’åˆ†åï¼Œç†µå€¼å‡å°‘çš„æœ€å¤§ï¼Œåˆ™æ¬¡ç‰¹å¾ä¸ºæœ€ä¼˜åˆ†ç±»ç‰¹å¾
</span>            <span class="n">bestInfoGain</span><span class="o">=</span><span class="n">infoGain</span>
            <span class="n">bestFeature</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">bestFeature</span>

<span class="k">def</span> <span class="nf">majorityCnt</span><span class="p">(</span><span class="n">classList</span><span class="p">):</span>    <span class="c1">#æŒ‰åˆ†ç±»åç±»åˆ«æ•°é‡æ’åºï¼Œæ¯”å¦‚ï¼šæœ€ååˆ†ç±»ä¸º2ç”·1å¥³ï¼Œåˆ™åˆ¤å®šä¸ºç”·ï¼›
</span>    <span class="n">classCount</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">vote</span> <span class="ow">in</span> <span class="n">classList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">vote</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classCount</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">classCount</span><span class="p">[</span><span class="n">vote</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">classCount</span><span class="p">[</span><span class="n">vote</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
    <span class="n">sortedClassCount</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">classCount</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sortedClassCount</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">createTree</span><span class="p">(</span><span class="n">dataSet</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
    <span class="n">classList</span><span class="o">=</span><span class="p">[</span><span class="n">example</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">dataSet</span><span class="p">]</span>  <span class="c1"># ç±»åˆ«ï¼šç”·æˆ–å¥³
</span>    <span class="k">if</span> <span class="n">classList</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">classList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">classList</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">classList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataSet</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">majorityCnt</span><span class="p">(</span><span class="n">classList</span><span class="p">)</span>
    <span class="n">bestFeat</span><span class="o">=</span><span class="n">chooseBestFeatureToSplit</span><span class="p">(</span><span class="n">dataSet</span><span class="p">)</span> <span class="c1">#é€‰æ‹©æœ€ä¼˜ç‰¹å¾
</span>    <span class="n">bestFeatLabel</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">bestFeat</span><span class="p">]</span>
    <span class="n">myTree</span><span class="o">=</span><span class="p">{</span><span class="n">bestFeatLabel</span><span class="p">:{}}</span> <span class="c1">#åˆ†ç±»ç»“æœä»¥å­—å…¸å½¢å¼ä¿å­˜
</span>    <span class="k">del</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">bestFeat</span><span class="p">])</span>
    <span class="n">featValues</span><span class="o">=</span><span class="p">[</span><span class="n">example</span><span class="p">[</span><span class="n">bestFeat</span><span class="p">]</span> <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">dataSet</span><span class="p">]</span>
    <span class="n">uniqueVals</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">featValues</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">uniqueVals</span><span class="p">:</span>
        <span class="n">subLabels</span><span class="o">=</span><span class="n">labels</span><span class="p">[:]</span>
        <span class="n">myTree</span><span class="p">[</span><span class="n">bestFeatLabel</span><span class="p">][</span><span class="n">value</span><span class="p">]</span><span class="o">=</span><span class="n">createTree</span><span class="p">(</span><span class="n">splitDataSet</span>\
                            <span class="p">(</span><span class="n">dataSet</span><span class="p">,</span><span class="n">bestFeat</span><span class="p">,</span><span class="n">value</span><span class="p">),</span><span class="n">subLabels</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">myTree</span>


<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">dataSet</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">createDataSet1</span><span class="p">()</span>  <span class="c1"># åˆ›é€ ç¤ºåˆ—æ•°æ®
</span>    <span class="k">print</span><span class="p">(</span><span class="n">createTree</span><span class="p">(</span><span class="n">dataSet</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>  <span class="c1"># è¾“å‡ºå†³ç­–æ ‘æ¨¡å‹ç»“æœ
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="-c45ç®—æ³•">âœ… C4.5ç®—æ³•</h4>

<p><strong>èƒŒæ™¯</strong>ï¼šæˆ‘ä»¬çŸ¥é“ä¿¡æ¯å¢ç›Šä¼šåå‘å–å€¼è¾ƒå¤šçš„ç‰¹å¾ï¼Œä½¿ç”¨ä¿¡æ¯å¢ç›Šæ¯”å¯ä»¥å¯¹è¿™ä¸€é—®é¢˜è¿›è¡Œæ ¡æ­£ã€‚</p>

<table>
  <tbody>
    <tr>
      <td><strong>ä¿¡æ¯å¢ç›Š</strong>ï¼š$Gain(D,A) = H(D) â€“ H(D</td>
      <td>A)$ï¼Œç”¨äºID3çš„åˆ¤æ–­</td>
    </tr>
  </tbody>
</table>

<p><strong>ä¿¡æ¯å¢ç›Šæ¯”</strong>ï¼šç‰¹å¾Aå¯¹è®­ç»ƒæ•°æ®é›†Dçš„ä¿¡æ¯å¢ç›Šæ¯”GainRatio(D,A)å®šä¹‰ä¸ºå…¶ä¿¡æ¯å¢ç›ŠGain(D,A)ä¸è®­ç»ƒæ•°æ®é›†Dçš„ç»éªŒç†µH(D)ä¹‹æ¯”ï¼š</p>

<script type="math/tex; mode=display">GainRatio(D,A)=\frac{Gain(D,A)}{H(D)}</script>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">choose_best_feature_to_split</span><span class="p">(</span><span class="n">data_set</span><span class="p">):</span>
    <span class="s">"""
    æŒ‰ç…§æœ€å¤§ä¿¡æ¯å¢ç›Šæ¯”åˆ’åˆ†æ•°æ®
    :param data_set: æ ·æœ¬æ•°æ®ï¼Œå¦‚ï¼š [[1, 1, 'yes'], [1, 1, 'yes'], [1, 0, 'no'], [0, 1, 'no'], [0, 1, 'no']]
    :return:
    """</span>
    <span class="n">num_feature</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_set</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># ç‰¹å¾ä¸ªæ•°ï¼Œå¦‚ï¼šä¸æµ®å‡ºæ°´é¢æ˜¯å¦å¯ä»¥ç”Ÿå­˜	å’Œæ˜¯å¦æœ‰è„šè¹¼
</span>    <span class="n">base_entropy</span> <span class="o">=</span> <span class="n">calc_shannon_ent</span><span class="p">(</span><span class="n">data_set</span><span class="p">)</span> <span class="c1"># ç»éªŒç†µH(D)
</span>    <span class="n">best_info_gain_ratio</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">best_feature_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">feature_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_feature</span><span class="p">):</span>
        <span class="n">feature_val_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">number</span><span class="p">[</span><span class="n">feature_idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">data_set</span><span class="p">]</span>  <span class="c1"># å¾—åˆ°æŸä¸ªç‰¹å¾ä¸‹æ‰€æœ‰å€¼ï¼ˆæŸåˆ—ï¼‰
</span>        <span class="n">unique_feature_val_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">feature_val_list</span><span class="p">)</span>  <span class="c1"># è·å–æ— é‡å¤çš„å±æ€§ç‰¹å¾å€¼
</span>        <span class="n">new_entropy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">split_info</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">unique_feature_val_list</span><span class="p">:</span>
            <span class="n">sub_data_set</span> <span class="o">=</span> <span class="n">split_data_set</span><span class="p">(</span><span class="n">data_set</span><span class="p">,</span> <span class="n">feature_idx</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">prob</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_data_set</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_set</span><span class="p">))</span>  <span class="c1"># å³p(t)
</span>            <span class="n">new_entropy</span> <span class="o">+=</span> <span class="n">prob</span> <span class="o">*</span> <span class="n">calc_shannon_ent</span><span class="p">(</span><span class="n">sub_data_set</span><span class="p">)</span>  <span class="c1"># å¯¹å„å­é›†é¦™å†œç†µæ±‚å’Œ
</span>            <span class="n">split_info</span> <span class="o">+=</span> <span class="o">-</span><span class="n">prob</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">info_gain</span> <span class="o">=</span> <span class="n">base_entropy</span> <span class="o">-</span> <span class="n">new_entropy</span>  <span class="c1"># è®¡ç®—ä¿¡æ¯å¢ç›Šï¼Œg(D,A)=H(D)-H(D|A)
</span>        <span class="k">if</span> <span class="n">split_info</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># fix the overflow bug
</span>            <span class="k">continue</span>
        <span class="n">info_gain_ratio</span> <span class="o">=</span> <span class="n">info_gain</span> <span class="o">/</span> <span class="n">split_info</span>
        <span class="c1"># æœ€å¤§ä¿¡æ¯å¢ç›Šæ¯”
</span>        <span class="k">if</span> <span class="n">info_gain_ratio</span> <span class="o">&gt;</span> <span class="n">best_info_gain_ratio</span><span class="p">:</span>
            <span class="n">best_info_gain_ratio</span> <span class="o">=</span> <span class="n">info_gain_ratio</span>
            <span class="n">best_feature_idx</span> <span class="o">=</span> <span class="n">feature_idx</span>

    <span class="k">return</span> <span class="n">best_feature_idx</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="-cartç®—æ³•">âœ… CARTç®—æ³•</h4>

<p><strong>æ¦‚è¿°</strong>ï¼šCARTåˆ†ç±»æ ‘é¢„æµ‹åˆ†ç±»ç¦»æ•£å‹æ•°æ®ï¼Œé‡‡ç”¨åŸºå°¼æŒ‡æ•°é€‰æ‹©æœ€ä¼˜ç‰¹å¾ï¼ŒåŒæ—¶å†³å®šè¯¥ç‰¹å¾çš„æœ€ä¼˜äºŒå€¼åˆ‡åˆ†ç‚¹ã€‚</p>

<p><strong>æ¦‚ç‡åˆ†å¸ƒçš„åŸºå°¼æŒ‡æ•°å®šä¹‰</strong>ï¼šå‡è®¾æœ‰Kä¸ªç±»ï¼Œæ ·æœ¬ç‚¹å±äºç¬¬kä¸ªç±»çš„æ¦‚ç‡ä¸ºPk</p>

<script type="math/tex; mode=display">Gini(p)=\sum_{k=1}^mp_k(1-p_k)=1-\sum_{k=1}^Kp_k^2</script>

<p><strong>é›†åˆDçš„åŸºå°¼æŒ‡æ•°</strong>ï¼š</p>

<script type="math/tex; mode=display">Gini(D)=1-\sum_{k=1}^K(\frac{|C_k|}{D})^2</script>

<p><img src="https://pic2.zhimg.com/80/v2-95300197189b4b1b65eb42d1a6bbd7fd_hd.jpg" alt="img" /></p>

<p><strong>è¿‡ç¨‹æ¦‚è¿°</strong>ï¼šè®¡ç®—åŸºå°¼ç³»æ•°çš„åŠ æƒå¹³å‡ï¼Œæ±‚min</p>

<p><img src="https://shuwoom.com/wp-content/uploads/2018/10/fb6de7e8b17762b1caa14d6968407289.png" alt="img" /></p>

<p><img src="https://shuwoom.com/wp-content/uploads/2018/10/251158892a1340a1829e3a9f23dc477b.png" alt="img" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
</pre></td><td class="rouge-code"><pre><span class="c1"># -*- coding: utf-8 -*-
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">class</span> <span class="nc">Tree</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">true_branch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">false_branch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">true_branch</span> <span class="o">=</span> <span class="n">true_branch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">false_branch</span> <span class="o">=</span> <span class="n">false_branch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">=</span> <span class="n">col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summary</span> <span class="o">=</span> <span class="n">summary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">""</span>

<span class="k">def</span> <span class="nf">split_datas</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="s">"""
    æ ¹æ®æ¡ä»¶åˆ†ç¦»æ•°æ®é›†
    :param rows:
    :param value:
    :param column:
    :return:  (list1, list2)
    """</span>
    <span class="n">list1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">list1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">list2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">list1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">list2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">list1</span><span class="p">,</span> <span class="n">list2</span>


<span class="k">def</span> <span class="nf">calculate_diff_count</span><span class="p">(</span><span class="n">data_set</span><span class="p">):</span>
    <span class="s">"""
    åˆ†ç±»ç»Ÿè®¡data_setä¸­æ¯ä¸ªç±»åˆ«çš„æ•°é‡
    :param datas:å¦‚ï¼š[[5.1, 3.5, 1.4, 0.2, 'setosa'], [4.9, 3, 1.4, 0.2, 'setosa'],....]
    :return: å¦‚ï¼š{'setosa': 50, 'versicolor': 50, 'virginica': 50}
    """</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_set</span><span class="p">:</span>
        <span class="c1"># æ•°æ®çš„æœ€åä¸€åˆ—data[-1]æ˜¯ç±»åˆ«
</span>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">results</span>


<span class="k">def</span> <span class="nf">gini</span><span class="p">(</span><span class="n">data_set</span><span class="p">):</span>
    <span class="s">"""
    è®¡ç®—giniçš„å€¼ï¼Œå³Gini(p)
    :param data_set: å¦‚ï¼š[[5.1, 3.5, 1.4, 0.2, 'setosa'], [4.9, 3, 1.4, 0.2, 'setosa'],....]
    :return:
    """</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_set</span><span class="p">)</span>
    <span class="n">category_2_cnt</span> <span class="o">=</span> <span class="n">calculate_diff_count</span><span class="p">(</span><span class="n">data_set</span><span class="p">)</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">category_2_cnt</span><span class="p">:</span>
        <span class="nb">sum</span> <span class="o">+=</span> <span class="nb">pow</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">category_2_cnt</span><span class="p">[</span><span class="n">category</span><span class="p">])</span> <span class="o">/</span> <span class="n">length</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">sum</span>


<span class="k">def</span> <span class="nf">build_decision_tree</span><span class="p">(</span><span class="n">data_set</span><span class="p">,</span> <span class="n">evaluation_function</span><span class="o">=</span><span class="n">gini</span><span class="p">):</span>
    <span class="s">"""
    é€’å½’å»ºç«‹å†³ç­–æ ‘ï¼Œå½“gain=0æ—¶ï¼Œåœæ­¢å›å½’
    :param data_set: å¦‚ï¼š[[5.1, 3.5, 1.4, 0.2, 'setosa'], [4.9, 3, 1.4, 0.2, 'setosa'],....]
    :param evaluation_function:
    :return:
    """</span>
    <span class="n">current_gain</span> <span class="o">=</span> <span class="n">evaluation_function</span><span class="p">(</span><span class="n">data_set</span><span class="p">)</span>
    <span class="n">column_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_set</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rows_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_set</span><span class="p">)</span>

    <span class="n">best_gain</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">best_value</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">best_set</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># choose the best gain
</span>    <span class="k">for</span> <span class="n">feature_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">column_length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">feature_value_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">feature_idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data_set</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feature_value</span> <span class="ow">in</span> <span class="n">feature_value_set</span><span class="p">:</span>
            <span class="n">sub_data_set1</span><span class="p">,</span> <span class="n">sub_data_set2</span> <span class="o">=</span> <span class="n">split_datas</span><span class="p">(</span><span class="n">data_set</span><span class="p">,</span> <span class="n">feature_value</span><span class="p">,</span> <span class="n">feature_idx</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sub_data_set1</span><span class="p">))</span> <span class="o">/</span> <span class="n">rows_length</span>
            <span class="c1"># Gini(D,A)è¡¨ç¤ºåœ¨ç‰¹å¾Açš„æ¡ä»¶ä¸‹é›†åˆDçš„åŸºå°¼æŒ‡æ•°ï¼Œgini_d_aè¶Šå°ï¼Œæ ·æœ¬é›†åˆä¸ç¡®å®šæ€§è¶Šå°
</span>            <span class="c1"># æˆ‘ä»¬çš„ç›®çš„æ˜¯æ‰¾åˆ°å¦gini_d_aæœ€å°çš„ç‰¹å¾ï¼ŒåŠgainæœ€å¤§çš„ç‰¹å¾
</span>            <span class="n">gini_d_a</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">evaluation_function</span><span class="p">(</span><span class="n">sub_data_set1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">evaluation_function</span><span class="p">(</span><span class="n">sub_data_set2</span><span class="p">)</span>
            <span class="n">gain</span> <span class="o">=</span> <span class="n">current_gain</span> <span class="o">-</span> <span class="n">gini_d_a</span>
            <span class="k">if</span> <span class="n">gain</span> <span class="o">&gt;</span> <span class="n">best_gain</span><span class="p">:</span>
                <span class="n">best_gain</span> <span class="o">=</span> <span class="n">gain</span>
                <span class="n">best_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">feature_idx</span><span class="p">,</span> <span class="n">feature_value</span><span class="p">)</span>
                <span class="n">best_set</span> <span class="o">=</span> <span class="p">(</span><span class="n">sub_data_set1</span><span class="p">,</span> <span class="n">sub_data_set2</span><span class="p">)</span>
    <span class="n">dc_y</span> <span class="o">=</span> <span class="p">{</span><span class="s">'impurity'</span><span class="p">:</span> <span class="s">'</span><span class="si">%.3</span><span class="s">f'</span> <span class="o">%</span> <span class="n">current_gain</span><span class="p">,</span> <span class="s">'sample'</span><span class="p">:</span> <span class="s">'</span><span class="si">%</span><span class="s">d'</span> <span class="o">%</span> <span class="n">rows_length</span><span class="p">}</span>

    <span class="c1"># stop or not stop
</span>    <span class="k">if</span> <span class="n">best_gain</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">true_branch</span> <span class="o">=</span> <span class="n">build_decision_tree</span><span class="p">(</span><span class="n">best_set</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">evaluation_function</span><span class="p">)</span>
        <span class="n">false_branch</span> <span class="o">=</span> <span class="n">build_decision_tree</span><span class="p">(</span><span class="n">best_set</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">evaluation_function</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Tree</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">best_value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="n">best_value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">true_branch</span><span class="o">=</span><span class="n">true_branch</span><span class="p">,</span> <span class="n">false_branch</span><span class="o">=</span><span class="n">false_branch</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="n">dc_y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Tree</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="n">calculate_diff_count</span><span class="p">(</span><span class="n">data_set</span><span class="p">),</span> <span class="n">summary</span><span class="o">=</span><span class="n">dc_y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_set</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">prune</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">mini_gain</span><span class="p">,</span> <span class="n">evaluation_function</span><span class="o">=</span><span class="n">gini</span><span class="p">):</span>
    <span class="s">"""
    è£å‰ª
    :param tree:
    :param mini_gain:
    :param evaluation_function:
    :return:
    """</span>
    <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">true_branch</span><span class="o">.</span><span class="n">results</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">prune</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">true_branch</span><span class="p">,</span> <span class="n">mini_gain</span><span class="p">,</span> <span class="n">evaluation_function</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">false_branch</span><span class="o">.</span><span class="n">results</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">prune</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">false_branch</span><span class="p">,</span> <span class="n">mini_gain</span><span class="p">,</span> <span class="n">evaluation_function</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">true_branch</span><span class="o">.</span><span class="n">results</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">false_branch</span><span class="o">.</span><span class="n">results</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">len1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">true_branch</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">len2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">false_branch</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">len3</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">true_branch</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">tree</span><span class="o">.</span><span class="n">false_branch</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">len1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">len1</span> <span class="o">+</span> <span class="n">len2</span><span class="p">)</span>

        <span class="n">gain</span> <span class="o">=</span> <span class="n">evaluation_function</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">true_branch</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">tree</span><span class="o">.</span><span class="n">false_branch</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> \
               <span class="o">-</span> <span class="n">p</span> <span class="o">*</span> <span class="n">evaluation_function</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">true_branch</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>\
               <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">evaluation_function</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">false_branch</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">gain</span> <span class="o">&lt;</span> <span class="n">mini_gain</span><span class="p">:</span>
            <span class="c1"># å½“èŠ‚ç‚¹çš„gainå°äºç»™å®šçš„ mini Gainæ—¶åˆ™åˆå¹¶è¿™ä¸¤ä¸ªèŠ‚ç‚¹
</span>            <span class="n">tree</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">true_branch</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">tree</span><span class="o">.</span><span class="n">false_branch</span><span class="o">.</span><span class="n">data</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">calculate_diff_count</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">true_branch</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">false_branch</span> <span class="o">=</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
    <span class="s">"""
    åˆ†ç±»
    :param data:
    :param tree:
    :return:
    """</span>
    <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">results</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">results</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">branch</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">tree</span><span class="o">.</span><span class="n">col</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">branch</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">true_branch</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">branch</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">false_branch</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">branch</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">true_branch</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">branch</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">false_branch</span>
        <span class="k">return</span> <span class="n">classify</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">load_csv</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">convert_types</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">if</span> <span class="s">'.'</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">"datas.csv"</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">"str"</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">","</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>
    <span class="n">data_set</span> <span class="o">=</span> <span class="p">([[</span><span class="n">convert_types</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">data_set</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">data_set</span> <span class="o">=</span> <span class="n">load_csv</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">data_set</span>
    <span class="n">decistion_tree</span> <span class="o">=</span> <span class="n">build_decision_tree</span><span class="p">(</span><span class="n">data_set</span><span class="p">,</span> <span class="n">evaluation_function</span><span class="o">=</span><span class="n">gini</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">decistion_tree</span><span class="o">.</span><span class="n">results</span>
    <span class="c1"># prune(decistion_tree, 0.4)
</span>    <span class="k">print</span> <span class="n">classify</span><span class="p">([</span><span class="mf">5.1</span><span class="p">,</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">1.4</span><span class="p">,</span><span class="mf">0.2</span><span class="p">],</span> <span class="n">decistion_tree</span><span class="p">)</span> <span class="c1"># setosa
</span>    <span class="k">print</span> <span class="n">classify</span><span class="p">([</span><span class="mf">6.8</span><span class="p">,</span><span class="mf">2.8</span><span class="p">,</span><span class="mf">4.8</span><span class="p">,</span><span class="mf">1.4</span><span class="p">],</span> <span class="n">decistion_tree</span><span class="p">)</span> <span class="c1"># versicolor
</span>    <span class="k">print</span> <span class="n">classify</span><span class="p">([</span><span class="mf">6.8</span><span class="p">,</span><span class="mf">3.2</span><span class="p">,</span><span class="mf">5.9</span><span class="p">,</span><span class="mf">2.3</span><span class="p">],</span> <span class="n">decistion_tree</span><span class="p">)</span> <span class="c1"># virginica
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="ï¸-knnåˆ†ç±»">â˜£ï¸ KNNåˆ†ç±»</h3>

<h3 id="ï¸-pcaæ¨¡å‹">â˜£ï¸ PCAæ¨¡å‹</h3>

<h3 id="ï¸-emç®—æ³•">â˜£ï¸ EMç®—æ³•</h3>

<h3 id="ï¸-aprioriç®—æ³•">â˜£ï¸ Aprioriç®—æ³•</h3>

<h3 id="ï¸-æœ€å¤§æœŸæœ›ç®—æ³•">â˜£ï¸ æœ€å¤§æœŸæœ›ç®—æ³•</h3>

<h3 id="ï¸-k-meansç®—æ³•">â˜£ï¸ K-Meansç®—æ³•</h3>

<h3 id="ï¸-svmç®—æ³•">â˜£ï¸ SVMç®—æ³•</h3>

<h3 id="ï¸-adaboostç®—æ³•">â˜£ï¸ Adaboostç®—æ³•</h3>

<h3 id="ï¸-è´å¶æ–¯æ¨¡å‹naive-bayes">â˜£ï¸ è´å¶æ–¯æ¨¡å‹ï¼ˆNaive Bayesï¼‰</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python
# -*- coding: utf-8 -*-
#########################################
# Bayes : ç”¨æ¥æè¿°ä¸¤ä¸ªæ¡ä»¶æ¦‚ç‡ä¹‹é—´çš„å…³ç³»
</span>
<span class="c1"># å‚æ•°:        inX: vector to compare to existing dataset (1xN)
#             dataSet: size m data set of known vectors (NxM)
#             labels: data set labels (1xM vector)
#             å…¬å¼ï¼šP(A|B)=P(B|A)P(A)/P(B)
# è¾“å‡º:       å‡ºé”™ç‡
#########################################
</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">npy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1">#P(B|A)=P(A|B)*P(A)/P(B)
</span>
<span class="c1"># æ•°æ®é›†ç›®å½•
</span><span class="n">dataSetDir</span> <span class="o">=</span><span class="s">'/Users/sean/Datasets'</span>

<span class="k">class</span> <span class="nc">Bayes</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">=-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelrate</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorrate</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dataset</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span><span class="n">labels</span><span class="p">:</span><span class="nb">list</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"è®­ç»ƒå¼€å§‹"</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"è¾“å…¥æµ‹è¯•æ•°ç»„å’Œç±»åˆ«æ•°ç»„é•¿åº¦ä¸ä¸€è‡´"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="c1">#è®­ç»ƒæ•°æ®ç‰¹å¾å€¼çš„é•¿åº¦
</span>        <span class="n">labelsnum</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="c1">#ç±»åˆ«çš„æ•°é‡
</span>        <span class="n">norlabels</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="c1">#ä¸é‡å¤ç±»åˆ«çš„æ•°é‡
</span>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">norlabels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labelrate</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">/</span><span class="n">labelsnum</span> <span class="c1">#æ±‚å½“å‰ç±»åˆ«å æ€»ç±»åˆ«çš„æ¯”ä¾‹
</span>        <span class="k">for</span> <span class="n">vector</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorrate</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vectorrate</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vectorrate</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"è®­ç»ƒç»“æŸ"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">btest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">testdata</span><span class="p">,</span><span class="n">labelset</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"æœªå¼€å§‹è®­ç»ƒï¼Œå…ˆè®­ç»ƒ"</span><span class="p">)</span>
        <span class="c1">#è®¡ç®—testdataåˆ†åˆ«ä¸ºå„ä¸ªç±»åˆ«çš„æ¦‚ç‡
</span>        <span class="n">lbDict</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">thislb</span> <span class="ow">in</span> <span class="n">labelset</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">alllabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelrate</span><span class="p">[</span><span class="n">thislb</span><span class="p">]</span>
            <span class="n">allvector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorrate</span><span class="p">[</span><span class="n">thislb</span><span class="p">]</span>
            <span class="n">vnum</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">allvector</span><span class="p">)</span>
            <span class="n">allvector</span><span class="o">=</span><span class="n">npy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">allvector</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">testdata</span><span class="p">)):</span>
                <span class="n">vector</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">allvector</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                <span class="n">p</span><span class="o">*=</span><span class="n">vector</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">testdata</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="o">/</span><span class="n">vnum</span>
            <span class="n">lbDict</span><span class="p">[</span><span class="n">thislb</span><span class="p">]</span><span class="o">=</span><span class="n">p</span> <span class="o">*</span> <span class="n">alllabel</span>
        <span class="n">thislbabel</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">lbDict</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">lbDict</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">thislbabel</span>

<span class="c1">#åŠ è½½æ•°æ®
</span><span class="k">def</span> <span class="nf">datatoarray</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="n">arr</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">32</span><span class="p">):</span>
        <span class="n">thisline</span><span class="o">=</span><span class="n">fh</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">32</span><span class="p">):</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">thisline</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">arr</span>

<span class="c1">#å»ºç«‹ä¸€ä¸ªå‡½æ•°å–å‡ºlabels
</span><span class="k">def</span> <span class="nf">seplabel</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="n">filestr</span><span class="o">=</span><span class="n">fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"."</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">label</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">filestr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"_"</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">label</span>

<span class="c1">#å»ºç«‹è®­ç»ƒæ•°æ®
</span><span class="k">def</span> <span class="nf">traindata</span><span class="p">():</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">trainfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dataSetDir</span><span class="o">+</span><span class="s">"trainingDigits"</span><span class="p">)</span> <span class="c1"># åŠ è½½æµ‹è¯•æ•°æ®
</span>    <span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">trainfile</span><span class="p">)</span>
    <span class="n">trainarr</span><span class="o">=</span><span class="n">npy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num</span><span class="p">,</span><span class="mi">1024</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="n">thisfname</span><span class="o">=</span><span class="n">trainfile</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">thislabel</span><span class="o">=</span><span class="n">seplabel</span><span class="p">(</span><span class="n">thisfname</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thislabel</span><span class="p">)</span>
        <span class="n">trainarr</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span><span class="o">=</span><span class="n">datatoarray</span><span class="p">(</span><span class="n">dataSetDir</span><span class="o">+</span><span class="s">"trainingDigits/"</span><span class="o">+</span><span class="n">thisfname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">trainarr</span><span class="p">,</span><span class="n">labels</span>

<span class="c1"># è´å¶æ–¯ç®—æ³•æ‰‹å†™è¯†åˆ«ä¸»æµç¨‹
</span><span class="n">bys</span><span class="o">=</span><span class="n">Bayes</span><span class="p">()</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># # step 1: è®­ç»ƒæ•°æ®é›†
</span><span class="n">train_data</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">traindata</span><span class="p">()</span>
<span class="n">train_data</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>
<span class="n">bys</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span><span class="n">labels</span><span class="p">)</span>

<span class="c1"># # step 2:æµ‹è¯•æ•°æ®é›†
</span><span class="n">thisdata</span><span class="o">=</span><span class="n">datatoarray</span><span class="p">(</span><span class="n">dataSetDir</span><span class="o">+</span><span class="s">"testDigits/8_90.txt"</span><span class="p">)</span>
<span class="n">labelsall</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>

<span class="c1"># # è¯†åˆ«å•ä¸ªæ‰‹å†™ä½“æ•°å­—
# test=bys.btest(thisdata,labelsall)
# print(test)
</span>
<span class="c1"># # è¯†åˆ«å¤šä¸ªæ‰‹å†™ä½“æ•°å­—ï¼ˆæ‰¹é‡å¤„ç†ï¼‰,å¹¶è¾“å‡ºç»“æœ
</span><span class="n">testfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dataSetDir</span><span class="o">+</span><span class="s">"testDigits"</span><span class="p">)</span>
<span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">testfile</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="n">thisfilename</span><span class="o">=</span><span class="n">testfile</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">thislabel</span><span class="o">=</span><span class="n">seplabel</span><span class="p">(</span><span class="n">thisfilename</span><span class="p">)</span>
    <span class="n">thisdataarr</span><span class="o">=</span><span class="n">datatoarray</span><span class="p">(</span><span class="n">dataSetDir</span><span class="o">+</span><span class="s">"testDigits/"</span><span class="o">+</span><span class="n">thisfilename</span><span class="p">)</span>
    <span class="n">label</span><span class="o">=</span><span class="n">bys</span><span class="o">.</span><span class="n">btest</span><span class="p">(</span><span class="n">thisdataarr</span><span class="p">,</span><span class="n">labelsall</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"æµ‹è¯•æ•°å­—æ˜¯ï¼š"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">thislabel</span><span class="p">)</span><span class="o">+</span><span class="s">"  è¯†åˆ«å‡ºæ¥çš„æ•°å­—æ˜¯ï¼š"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">label</span><span class="o">!=</span><span class="n">thislabel</span><span class="p">:</span>
        <span class="n">x</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"è¯†åˆ«å‡ºé”™"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"å‡ºé”™ç‡ï¼š"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">num</span><span class="p">))</span>

<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">running_time</span> <span class="o">=</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span>
<span class="k">print</span><span class="p">(</span><span class="s">'ç¨‹åºè¿è¡Œæ€»è€—æ—¶ï¼š </span><span class="si">%.5</span><span class="s">f sec'</span> <span class="o">%</span><span class="n">running_time</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="å­¦ä¹ ç½‘ç»œ">å­¦ä¹ ç½‘ç»œ</h2>

<h3 id="ï¸-æ¢¯åº¦ä¸‹é™">â˜£ï¸ æ¢¯åº¦ä¸‹é™</h3>

<h3 id="ï¸-bpç½‘ç»œ">â˜£ï¸ BPç½‘ç»œ</h3>

<h3 id="ï¸-rnnç³»åˆ—">â˜£ï¸ RNNç³»åˆ—</h3>

<h4 id="ï¸-rnnæ¨¡å‹">â˜£ï¸ RNNæ¨¡å‹</h4>

<p><img src="https://caicai.science/images/attention/roolled%20rnn.png" alt="roolled RNN" /></p>

<h4 id="ï¸-lstm">â˜£ï¸ LSTM</h4>

<h4 id="ï¸-gru">â˜£ï¸ GRU</h4>

<h2 id="ç›¸å…³å†…å®¹">ç›¸å…³å†…å®¹</h2>

<h3 id="ï¸-æ¢¯åº¦çˆ†ç‚¸é—®é¢˜">â˜£ï¸ æ¢¯åº¦çˆ†ç‚¸é—®é¢˜</h3>

<h3 id="ï¸-ä»£ä»·å‡½æ•°">â˜£ï¸ ä»£ä»·å‡½æ•°</h3>

<h4 id="-äºŒæ¬¡ä»£ä»·å‡½æ•°">âœ… äºŒæ¬¡ä»£ä»·å‡½æ•°</h4>

<p><img src="https://img-blog.csdn.net/20160402180717102" alt="img" /></p>

<p><img src="https://img-blog.csdn.net/20160402175137034" alt="img" /></p>

<h4 id="-äº¤å‰ç†µæŸå¤±å‡½æ•°">âœ… äº¤å‰ç†µæŸå¤±å‡½æ•°</h4>

<p><img src="https://img-blog.csdn.net/20160402172100739" alt="img" /></p>

<p>å‚è€ƒèµ„æ–™ï¼šhttps://blog.csdn.net/u014313009/article/details/51043064</p>

<h2 id="å‰æ²¿ç ”ç©¶">å‰æ²¿ç ”ç©¶</h2>

<h3 id="-sequence-to-sequence">âœ… Sequence to Sequence</h3>

<p><img src="https://img-blog.csdn.net/20171101103708217" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p><img src="https://images2018.cnblogs.com/blog/1192699/201808/1192699-20180806141638641-1078830067.png" alt="img" /></p>

<p><strong>æ¦‚è¿°</strong>ï¼šä¸€ç§å‡½æ•°æ˜ å°„æ¨¡å‹ï¼Œå…·æœ‰å¼±çº¦æŸçš„å¤šå¯¹å¤šå¯¹åº”å…³ç³»ã€‚</p>

<p><strong>åŸç†</strong>ï¼šå·¦ä¾§Encoderç¼–ç å°†è¾“å…¥åºåˆ—è½¬åŒ–æˆä¸€ä¸ªå›ºå®šé•¿åº¦çš„å‘é‡ç¼–ç ï¼Œå³ä¾§Decoderè§£ç å°†ä¹‹å‰ç”Ÿæˆçš„å›ºå®šå‘é‡å†è½¬åŒ–æˆè¾“å‡ºåºåˆ—ï¼Œç¼–è§£ç éƒ¨åˆ†å¯ä»¥é‡‡ç”¨CNNã€RNNã€LSTMã€GRUã€BLSTMç­‰å®ç°ã€‚å¯ä»¥é¢„æµ‹ä»»æ„çš„åºåˆ—å¯¹åº”å…³ç³»ã€‚</p>

<p><strong>æ„ä¹‰</strong>ï¼šç¬¬ä¸€æ¬¡æå‡ºäº†Encoder-Decoderæ¨¡å‹ï¼Œä¸»è¦ç”¨äºåºåˆ—é¢„æµ‹</p>

<p><strong>é—®é¢˜</strong>ï¼šEncoderæ˜¯å°†è¾“å…¥å†…å®¹å‹ç¼©åˆ°ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å‘é‡ä¸­ï¼Œè¯­ä¹‰ç¼–ç æ˜¯å›ºå®šé•¿åº¦ï¼Œç„¶åè®¡ç®—å‡ºå†…å®¹è¿›è¡ŒDecoder</p>

<h3 id="-attention-mechanism">âœ… Attention Mechanism</h3>

<p>ã€ŠSequence to Sequence Learning with Neural Networksã€‹ä»‹ç»äº†ä¸€ç§åŸºäºRNNçš„Seq2Seqæ¨¡å‹ï¼ŒåŸºäºä¸€ä¸ªEncoderå’Œä¸€ä¸ªDecoderæ¥æ„å»ºåŸºäºç¥ç»ç½‘ç»œçš„End-to-Endçš„æœºå™¨ç¿»è¯‘æ¨¡å‹ï¼Œå…¶ä¸­ï¼ŒEncoderæŠŠè¾“å…¥Xç¼–ç æˆä¸€ä¸ªå›ºå®šé•¿åº¦çš„éšå‘é‡Zï¼ŒDecoderåŸºäºéšå‘é‡Zè§£ç å‡ºç›®æ ‡è¾“å‡ºYã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„åºåˆ—åˆ°åºåˆ—çš„æ¨¡å‹ï¼Œä½†æ˜¯å´å­˜åœ¨<strong>ä¸¤ä¸ªæ˜æ˜¾çš„é—®é¢˜</strong>ï¼š</p>

<p>1ã€æŠŠè¾“å…¥Xçš„æ‰€æœ‰ä¿¡æ¯æœ‰å‹ç¼©åˆ°ä¸€ä¸ªå›ºå®šé•¿åº¦çš„éšå‘é‡Zï¼Œå¿½ç•¥äº†è¾“å…¥è¾“å…¥Xçš„é•¿åº¦ï¼Œå½“è¾“å…¥å¥å­é•¿åº¦å¾ˆé•¿ï¼Œç‰¹åˆ«æ˜¯æ¯”è®­ç»ƒé›†ä¸­æœ€åˆçš„å¥å­é•¿åº¦è¿˜é•¿æ—¶ï¼Œæ¨¡å‹çš„æ€§èƒ½æ€¥å‰§ä¸‹é™ã€‚</p>

<p>2ã€æŠŠè¾“å…¥Xç¼–ç æˆä¸€ä¸ªå›ºå®šçš„é•¿åº¦ï¼Œå¯¹äºå¥å­ä¸­æ¯ä¸ªè¯éƒ½èµ‹äºˆç›¸åŒçš„æƒé‡ï¼Œè¿™æ ·åšæ˜¯ä¸åˆç†çš„ï¼Œæ¯”å¦‚ï¼Œåœ¨æœºå™¨ç¿»è¯‘é‡Œï¼Œè¾“å…¥çš„å¥å­ä¸è¾“å‡ºå¥å­ä¹‹é—´ï¼Œå¾€å¾€æ˜¯è¾“å…¥ä¸€ä¸ªæˆ–å‡ ä¸ªè¯å¯¹åº”äºè¾“å‡ºçš„ä¸€ä¸ªæˆ–å‡ ä¸ªè¯ã€‚å› æ­¤ï¼Œå¯¹è¾“å…¥çš„æ¯ä¸ªè¯èµ‹äºˆç›¸åŒæƒé‡ï¼Œè¿™æ ·åšæ²¡æœ‰åŒºåˆ†åº¦ï¼Œå¾€å¾€æ˜¯æ¨¡å‹æ€§èƒ½ä¸‹é™ã€‚</p>

<p><strong>æ¨¡å‹ç¤ºä¾‹</strong>ï¼šå¯ä»¥ä¸Seq2Seqå¯¹æ¯”ï¼Œä¸­é—´å¢åŠ äº†ä¸€ä¸ªæƒé‡å±‚ï¼Œé€šè¿‡ä¸åŒçš„è¯­ä¹‰ç¼–ç å®ç°ï¼ˆä¹Ÿå°±æ˜¯ä¸åŒé•¿åº¦çš„å‘é‡ï¼‰</p>

<p><img src="https://images2018.cnblogs.com/blog/1192699/201808/1192699-20180806142115912-1682939089.png" alt="img" style="zoom:70%;" /></p>

<p><img src="https://images2018.cnblogs.com/blog/1192699/201808/1192699-20180806142159178-1634092293.png" alt="img" style="zoom:70%;" /></p>

<p>å‚è€ƒèµ„æ–™ï¼šhttps://zhuanlan.zhihu.com/p/31547842ï¼ˆæ³¨æ„åŠ›æ¨¡å‹æ±‡æ€»æœºåŠå…¶åº”ç”¨ï¼‰ã€https://www.cnblogs.com/guoyaohua/p/9429924.htmlï¼ˆæ³¨æ„åŠ›æœºåˆ¶è§£é‡ŠåŠå…¶åº”ç”¨ï¼‰</p>

<h3 id="ï¸-pointer-network">â˜£ï¸ Pointer Network</h3>

<h3 id="ï¸-graph-embedding">â˜£ï¸ Graph Embedding</h3>

<p>##è¿ç§»å­¦ä¹ </p>

<h2 id="å¼ºåŒ–å­¦ä¹ reinforcement-learning">å¼ºåŒ–å­¦ä¹ ï¼ˆReinforcement Learningï¼‰</h2>

<h3 id="ï¸-ä»‹ç»">â˜£ï¸ ä»‹ç»</h3>

<p><img src="https://user-gold-cdn.xitu.io/2019/8/18/16ca41b0a58edcee?imageView2/0/w/1280/h/960/ignore-error/1" alt="img" /></p>

<p>å¦‚ä¸Šå›¾å·¦è¾¹æ‰€ç¤ºï¼Œä¸€ä¸ªagent(ä¾‹å¦‚ï¼šç©å®¶/æ™ºèƒ½ä½“ç­‰)åšå‡ºäº†ä¸€ä¸ªactionï¼Œå¯¹environmenté€ æˆäº†å½±å“ï¼Œä¹Ÿå°±æ˜¯æ”¹å˜äº†stateï¼Œè€Œenvironmentä¸ºäº†åé¦ˆç»™agentï¼Œagentå°±å¾—åˆ°äº†ä¸€ä¸ªå¥–åŠ±(ä¾‹å¦‚ï¼šç§¯åˆ†/åˆ†æ•°)ï¼Œä¸æ–­çš„è¿›è¡Œè¿™æ ·çš„å¾ªç¯ï¼Œç›´åˆ°ç»“æŸä¸ºæ­¢ã€‚</p>

<p>ä¸Šè¿°è¿‡ç¨‹å°±ç›¸å½“äºä¸€ä¸ª<strong>é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹</strong></p>

<p>ä¸Šå›¾å³è¾¹æ‰€ç¤ºï¼ŒS0 çŠ¶æ€ç»è¿‡äº† a0 çš„è¡Œä¸ºåï¼Œè·å¾—äº†å¥–åŠ± r1 ï¼Œå˜æˆäº†çŠ¶æ€S1ï¼Œååˆç»è¿‡äº† a0 è¡Œä¸ºå¾—åˆ°å¥–åŠ± r2ï¼Œå˜æˆäº†çŠ¶æ€ S2 ï¼Œå¦‚æ­¤å¾€å¤å¾ªç¯ï¼Œç›´åˆ°ç»“æŸä¸ºæ­¢ã€‚</p>

<p>é€šè¿‡ä»¥ä¸Šçš„æè¿°ï¼Œå¤§å®¶éƒ½å·²ç»ç¡®å®šäº†ä¸€ä¸ªæ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯agent(æ™ºèƒ½ä½“)åœ¨å½“ä¸‹åšå‡ºçš„å†³å®šè‚¯å®šä½¿å¾—æœªæ¥æ”¶ç›Šæœ€å¤§åŒ–ï¼Œé‚£ä¹ˆï¼Œä¸€ä¸ªé©¬å„¿å¯å¤«å†³ç­–è¿‡ç¨‹å¯¹åº”çš„å¥–åŠ±æ€»å’Œä¸ºï¼š</p>

<script type="math/tex; mode=display">R=r_1+r_2+r_3+...+r_n</script>

<p>t æ—¶åˆ»(å½“ä¸‹)çš„æœªæ¥å¥–åŠ±ï¼Œåªè€ƒè™‘åé¢çš„å¥–åŠ±ï¼Œå‰é¢çš„æ”¹å˜ä¸äº†ï¼š</p>

<p>$R_t=r_t+r_{t+1}+r_{t+2}+â€¦+r_n$</p>

<p>å½“å‰çš„è¡Œä¸ºå¯¹äºæœªæ¥æ˜¯ä¸ç¡®å®šæ€§çš„ï¼Œè¦æ‰“ä¸€ä¸ªæŠ˜æ‰£ï¼Œä¹Ÿå°±æ˜¯åŠ å…¥ä¸€ä¸ªç³»æ•°gammaï¼Œæ˜¯ä¸€ä¸ª 0 åˆ° 1 çš„å€¼ï¼š</p>

<script type="math/tex; mode=display">R_t=r_1+\gamma_{}r_{t+1}+\gamma^2r_{t+2}+...+\gamma^{n-1}r_n</script>

<p>ç¦»å½“å‰è¶Šè¿œçš„æ—¶é—´ï¼Œgammaçš„æƒ©ç½šç³»æ•°å°±ä¼šè¶Šå¤§ï¼Œä¹Ÿå°±æ˜¯è¶Šä¸ç¡®å®šã€‚ä¸ºçš„å°±æ˜¯åœ¨å½“å‰å’Œæœªæ¥çš„å†³ç­–ä¸­å–å¾—ä¸€ä¸ªå¹³è¡¡ã€‚gammaå– 0 ï¼Œç›¸å½“äºä¸è€ƒè™‘æœªæ¥ï¼Œåªè€ƒè™‘å½“ä¸‹ï¼Œæ˜¯ä¸€ç§å¾ˆçŸ­è§†çš„åšæ³•ï¼›è€Œgammaå– 1 ï¼Œåˆ™å®Œå…¨è€ƒè™‘äº†æœªæ¥ï¼Œåˆæœ‰ç‚¹è¿‡è™‘äº†ã€‚æ‰€ä»¥ä¸€èˆ¬gammaä¼šå– 0 åˆ° 1 ä¹‹é—´çš„ä¸€ä¸ªå€¼ã€‚</p>

<p>Rt å¯ä»¥ç”¨ Rt+1 æ¥è¡¨ç¤ºï¼Œå†™æˆé€’æ¨å¼ï¼š</p>

<script type="math/tex; mode=display">R_t=r_t+\gamma(r_{t+1}+\gamma(r_{t+2}+...))=r_t+\gamma_{}R_{t+1}</script>

<p>å‚è€ƒï¼šhttps://juejin.im/post/5d591d6af265da03c8151f4fã€https://easyai.tech/ai-definition/reinforcement-learning/</p>

<h3 id="ï¸-q-learning">â˜£ï¸ Q-Learning</h3>

<p><strong>Q(s, a)å‡½æ•°(Quality)ï¼Œè´¨é‡å‡½æ•°ç”¨æ¥è¡¨ç¤ºæ™ºèƒ½ä½“åœ¨sçŠ¶æ€ä¸‹é‡‡ç”¨aåŠ¨ä½œå¹¶åœ¨ä¹‹åé‡‡å–æœ€ä¼˜åŠ¨ä½œæ¡ä»¶ä¸‹</strong>çš„æ‰“æŠ˜çš„æœªæ¥å¥–åŠ±(å…ˆä¸ç®¡æœªæ¥çš„åŠ¨ä½œå¦‚ä½•é€‰æ‹©)ï¼š</p>

<script type="math/tex; mode=display">Q(s_t,a_t)=maxR_{t+1}</script>

<p>å‡è®¾æœ‰äº†è¿™ä¸ªQå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¤Ÿæ±‚å¾—åœ¨å½“å‰ t æ—¶åˆ»å½“ä¸­ï¼Œåšå‡ºå„ä¸ªå†³ç­–çš„æœ€å¤§æ”¶ç›Šå€¼ï¼Œé€šè¿‡å¯¹æ¯”è¿™äº›æ”¶ç›Šå€¼ï¼Œå°±èƒ½å¤Ÿ<strong>å¾—åˆ° t æ—¶åˆ»æŸä¸ªå†³ç­–æ˜¯è¿™äº›å†³ç­–å½“ä¸­æ”¶ç›Šæœ€é«˜ã€‚</strong></p>

<p>$\pi(s)=argmax_aQ(s,a)$</p>

<p>äºæ˜¯ä¹ï¼Œæ ¹æ®Qå‡½æ•°çš„é€’æ¨å…¬å¼å¯ä»¥å¾—åˆ°ï¼š</p>

<script type="math/tex; mode=display">Q(s_t,a_t)=r+\gamma_{}max_aQ(s_{t+1},a_{t+1})</script>

<p><strong>è¿™å°±æ˜¯æ³¨æ˜çš„è´å°”æ›¼å…¬å¼ã€‚</strong>è´å°”æ›¼å…¬å¼å®é™…éå¸¸åˆç†ã€‚å¯¹äºæŸä¸ªçŠ¶æ€æ¥è®²ï¼Œæœ€å¤§åŒ–æœªæ¥å¥–åŠ±ç›¸å½“äºæœ€å¤§åŒ–å³åˆ»å¥–åŠ±ä¸ä¸‹ä¸€çŠ¶æ€æœ€å¤§æœªæ¥å¥–åŠ±ä¹‹å’Œã€‚</p>

<p><strong>Q-learningçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</strong>æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡è´å°”æ›¼å…¬å¼è¿­ä»£åœ°è¿‘ä¼¼Q-å‡½æ•°ã€‚</p>

<p>å‚è€ƒï¼šhttps://juejin.im/post/5d591d6af265da03c8151f4f</p>

<h3 id="ï¸-dqn">â˜£ï¸ DQN</h3>

<p>Deep Q Learning(DQN)æ˜¯ä¸€ç§èåˆäº†ç¥ç»ç½‘ç»œå’Œçš„Q-Learningæ–¹æ³•ã€‚</p>

<p><strong>ç¥ç»ç½‘ç»œçš„ä½œç”¨</strong></p>

<p><img src="https://user-gold-cdn.xitu.io/2019/8/18/16ca41b0dc74ff8e?imageView2/0/w/1280/h/960/ignore-error/1" alt="img" /></p>

<p>ä½¿ç”¨è¡¨æ ¼æ¥å­˜å‚¨æ¯ä¸€ä¸ªçŠ¶æ€ state, å’Œåœ¨è¿™ä¸ª state æ¯ä¸ªè¡Œä¸º action æ‰€æ‹¥æœ‰çš„ Q å€¼. è€Œå½“ä»Šé—®é¢˜æ˜¯åœ¨å¤ªå¤æ‚, çŠ¶æ€å¯ä»¥å¤šåˆ°æ¯”å¤©ä¸Šçš„æ˜Ÿæ˜Ÿè¿˜å¤š(æ¯”å¦‚ä¸‹å›´æ£‹). å¦‚æœå…¨ç”¨è¡¨æ ¼æ¥å­˜å‚¨å®ƒä»¬, ææ€•æˆ‘ä»¬çš„è®¡ç®—æœºæœ‰å†å¤§çš„å†…å­˜éƒ½ä¸å¤Ÿ, è€Œä¸”æ¯æ¬¡åœ¨è¿™ä¹ˆå¤§çš„è¡¨æ ¼ä¸­æœç´¢å¯¹åº”çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸€ä»¶å¾ˆè€—æ—¶çš„äº‹. ä¸è¿‡, åœ¨æœºå™¨å­¦ä¹ ä¸­, æœ‰ä¸€ç§æ–¹æ³•å¯¹è¿™ç§äº‹æƒ…å¾ˆåœ¨è¡Œ, é‚£å°±æ˜¯ç¥ç»ç½‘ç»œ.</p>

<p>æˆ‘ä»¬å¯ä»¥å°†çŠ¶æ€å’ŒåŠ¨ä½œå½“æˆç¥ç»ç½‘ç»œçš„è¾“å…¥, ç„¶åç»è¿‡ç¥ç»ç½‘ç»œåˆ†æåå¾—åˆ°åŠ¨ä½œçš„ Q å€¼, è¿™æ ·æˆ‘ä»¬å°±æ²¡å¿…è¦åœ¨è¡¨æ ¼ä¸­è®°å½• Q å€¼, è€Œæ˜¯ç›´æ¥ä½¿ç”¨ç¥ç»ç½‘ç»œç”Ÿæˆ Q å€¼.</p>

<p>è¿˜æœ‰ä¸€ç§å½¢å¼çš„æ˜¯è¿™æ ·, æˆ‘ä»¬ä¹Ÿèƒ½åªè¾“å…¥çŠ¶æ€å€¼, è¾“å‡ºæ‰€æœ‰çš„åŠ¨ä½œå€¼, ç„¶åæŒ‰ç…§ Q learning çš„åŸåˆ™, ç›´æ¥é€‰æ‹©æ‹¥æœ‰æœ€å¤§å€¼çš„åŠ¨ä½œå½“åšä¸‹ä¸€æ­¥è¦åšçš„åŠ¨ä½œ.</p>

<p>æˆ‘ä»¬å¯ä»¥æƒ³è±¡, ç¥ç»ç½‘ç»œæ¥å—å¤–éƒ¨çš„ä¿¡æ¯, ç›¸å½“äºçœ¼ç›é¼»å­è€³æœµæ”¶é›†ä¿¡æ¯, ç„¶åé€šè¿‡å¤§è„‘åŠ å·¥è¾“å‡ºæ¯ç§åŠ¨ä½œçš„å€¼, æœ€åé€šè¿‡å¼ºåŒ–å­¦ä¹ çš„æ–¹å¼é€‰æ‹©åŠ¨ä½œ.</p>

<p><strong>ç¥ç»ç½‘ç»œè®¡ç®—Qå€¼</strong></p>

<p>è¿™ä¸€éƒ¨åˆ†å°±è·Ÿç›‘ç£å­¦ä¹ çš„ç¥ç»ç½‘ç»œä¸€æ ·äº†æˆ‘ï¼Œè¾“å…¥çŠ¶æ€å€¼ï¼Œè¾“å‡ºä¸ºQå€¼ï¼Œæ ¹æ®å¤§é‡çš„æ•°æ®å»è®­ç»ƒç¥ç»ç½‘ç»œçš„å‚æ•°ï¼Œæœ€ç»ˆå¾—åˆ°Q-Learningçš„è®¡ç®—æ¨¡å‹ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¨¡å‹æ¥è¿›è¡Œå¼ºåŒ–å­¦ä¹ äº†ã€‚</p>

<p><img src="https://user-gold-cdn.xitu.io/2019/8/18/16ca41b1338135c6?imageView2/0/w/1280/h/960/ignore-error/1" alt="img" /></p>

<p>å‚è€ƒï¼šhttps://juejin.im/post/5d591d6af265da03c8151f4f</p>

<h2 id="æ¨èç³»ç»Ÿ">æ¨èç³»ç»Ÿ</h2>

<h3 id="-ååŒè¿‡æ»¤æ¨¡å‹">âœ… ååŒè¿‡æ»¤æ¨¡å‹</h3>

<p><strong>ç›¸ä¼¼æ€§åº¦é‡æ–¹æ³•</strong></p>

<p>1.æ¬§å‡ é‡Œå¾—è·ç¦»ï¼šè¯¥è·ç¦»åªæœ‰å½“ä¸¤è€…ç‰¹å¾å‘é‡ä¸­æ¯ä¸ªç‰¹å¾éƒ½è¾ƒå°æ—¶ï¼Œç‰¹å¾å‘é‡é—´è·ç¦»æ‰æ¯”è¾ƒå°ã€‚</p>

<p>2.çš®å°”æ£®ç›¸å…³ç³»æ•°ï¼šè¯¥ç³»æ•°åº¦é‡ä¸¤ä¸ªç‰¹å¾å‘é‡ä¹‹é—´çš„çº¿æ€§ç›¸å…³æ€§ï¼ŒäºŒè€…çº¿æ€§ç›¸å…³ç¨‹åº¦è¶Šå¼ºï¼Œè¯¥åº¦é‡å€¼è¶Šé«˜ã€‚è¯¥åº¦é‡é€‚ç”¨äºä¸åŒç‰¹å¾çš„èŒƒå›´ä¸ä¸€æ ·çš„æƒ…å†µã€‚</p>

<p><strong>åŸºäºç”¨æˆ·ç›¸ä¼¼åº¦çš„æ¨è</strong></p>

<p>ä¸ºç”¨æˆ·Aæä¾›æ¨èï¼Œé¦–å…ˆé€‰æ‹©çš®å°”æ£®ç›¸å…³ç³»æ•°è¿›è¡Œåº¦é‡ï¼Œè®¡ç®—ä¸Aæœ€ç›¸ä¼¼çš„Nä¸ªäººï¼Œç„¶åè®¡ç®—æ¯éƒ¨ç”µå½±åœ¨ç›¸ä¼¼åº¦åŠ æƒå¹³å‡ä¸‹çš„åŠ æƒå¹³å‡å€¼ï¼Œä»¥è¯¥åˆ†å€¼ä½œä¸ºæ¯éƒ¨ç”µå½±çš„æ¨èå€¼ã€‚</p>

<p><strong>åŸºäºç‰©å“çš„åä½œå‹è¿‡æ»¤</strong></p>

<p>é¦–å…ˆå°†åŸå§‹å­—å…¸çš„é”®å’Œå€¼è¿›è¡Œè°ƒæ¢ï¼Œæ­¤æ—¶é”®ä¸ºç‰©å“ï¼Œå€¼ä¸ºä¸€ä¸ªå­—å…¸ï¼Œå­—å…¸çš„é”®ä¸ºç”¨æˆ·ï¼Œå€¼ä¸ºåˆ†å€¼ã€‚æ ¹æ®æ­¤å­—å…¸è¿è¡Œä¸Šè¿°çš„ç®—æ³•ï¼Œå…ˆæ±‚ç‰©å“ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚</p>

<p>æ¯”å¦‚è¦ç»™ç”¨æˆ·Aæä¾›æ¨èï¼ŒAåšå‡ºè¯„ä»·çš„ç‰©å“æœ‰1ï¼Œ2ï¼Œ3.æœªä½œå‡ºè¯„ä»·çš„ç‰©å“æœ‰4ï¼Œ5ï¼Œ6ã€‚è®¡ç®—ç‰©å“4çš„åˆ†å€¼ï¼Œéœ€è¦å…ˆè®¡ç®—ç‰©å“4ä¸ç‰©å“1ï¼Œ2ï¼Œ3çš„ç›¸ä¼¼åº¦ï¼Œä»¥ç›¸ä¼¼åº¦ä½œä¸ºæƒå€¼ï¼Œå¯¹ç‰©å“1ï¼Œ2ï¼Œ3çš„è¯„åˆ†è¿›è¡ŒåŠ æƒå¹³å‡ï¼Œä»¥æ­¤ä½œä¸ºå¯¹ç‰©å“4 è¯„åˆ†ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
</pre></td><td class="rouge-code"><pre><span class="c1"># -*- coding: utf-8 -*-
</span><span class="n">__author__</span> <span class="o">=</span> <span class="s">'Bai Chenjia'</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">class</span> <span class="nc">recommendation</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">critics</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Lisa Rose'</span><span class="p">:</span> <span class="p">{</span><span class="s">'Lady in the Water'</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s">'Snakes on a Plane'</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span> <span class="s">'Just My Luck'</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                                      <span class="s">'Superman Returns'</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span> <span class="s">'You, Me and Dupree'</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s">'The Night Listener'</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">},</span>
                        <span class="s">'Gene Seymour'</span><span class="p">:</span> <span class="p">{</span><span class="s">'Lady in the Water'</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s">'Snakes on a Plane'</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span> <span class="s">'Just My Luck'</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
                                         <span class="s">'Superman Returns'</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="s">'The Night Listener'</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s">'You, Me and Dupree'</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">},</span>
                        <span class="s">'Michael Phillips'</span><span class="p">:</span> <span class="p">{</span><span class="s">'Lady in the Water'</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s">'Snakes on a Plane'</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                                             <span class="s">'Superman Returns'</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span> <span class="s">'The Night Listener'</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">},</span>
                        <span class="s">'Claudia Puig'</span><span class="p">:</span> <span class="p">{</span><span class="s">'Snakes on a Plane'</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span> <span class="s">'Just My Luck'</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s">'The Night Listener'</span><span class="p">:</span> <span class="mf">4.5</span><span class="p">,</span>
                                         <span class="s">'Superman Returns'</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span> <span class="s">'You, Me and Dupree'</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">},</span>
                        <span class="s">'Mick LaSalle'</span><span class="p">:</span> <span class="p">{</span><span class="s">'Lady in the Water'</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s">'Snakes on a Plane'</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span> <span class="s">'Just My Luck'</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
                                         <span class="s">'Superman Returns'</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s">'The Night Listener'</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s">'You, Me and Dupree'</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">},</span>
                        <span class="s">'Jack Matthews'</span><span class="p">:</span> <span class="p">{</span><span class="s">'Lady in the Water'</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s">'Snakes on a Plane'</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span> <span class="s">'The Night Listener'</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
                                          <span class="s">'Superman Returns'</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="s">'You, Me and Dupree'</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">},</span>
                        <span class="s">'Toby'</span><span class="p">:</span> <span class="p">{</span><span class="s">'Snakes on a Plane'</span><span class="p">:</span> <span class="mf">4.5</span><span class="p">,</span> <span class="s">'You, Me and Dupree'</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s">'Superman Returns'</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">}}</span>

    <span class="k">def</span> <span class="nf">sim_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person1</span><span class="p">,</span> <span class="n">person2</span><span class="p">,</span> <span class="n">new_critics</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="s">"""
        ä½¿ç”¨æ¬§æ°è·ç¦»è®¡ç®—ç›¸ä¼¼åº¦. è¿”å›ç›¸ä¼¼åº¦æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°å€¼. è¿”å›å€¼ä¸º0ä»£è¡¨æ²¡æœ‰ç›¸ä¼¼æ€§.
        é¦–å…ˆè®¡ç®—ä¸¤ä¸ªäººæ‰€çœ‹ç›¸åŒç”µå½±è¯„åˆ†çš„æ¬§æ°è·ç¦»L. å¦‚ä¸¤äººæ²¡æœ‰è§‚çœ‹ç›¸åŒç”µå½±åˆ™è¿”å›0,å¦åˆ™è®¡ç®—ç›¸ä¼¼åº¦å…¬å¼ä¸º 1/(L+1).
        å…¶ä¸­åˆ†æ¯ä½¿ç”¨L+1æ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°åˆ†æ¯ä¸º0çš„æƒ…å†µ. æ¬§æ°è·ç¦»è¶Šå¤§ï¼Œç›¸ä¼¼åº¦è¶Šå°;æ¬§æ°è·ç¦»è¶Šå°ï¼Œç›¸ä¼¼åº¦è¶Šå¤§
        """</span>
        <span class="k">if</span> <span class="n">new_critics</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_critics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformPrefs</span><span class="p">()</span>
            <span class="n">movielist1</span> <span class="o">=</span> <span class="n">new_critics</span><span class="p">[</span><span class="n">person1</span><span class="p">]</span>
            <span class="n">movielist2</span> <span class="o">=</span> <span class="n">new_critics</span><span class="p">[</span><span class="n">person2</span><span class="p">]</span>   <span class="c1"># dict
</span>            <span class="n">commonlist</span> <span class="o">=</span> <span class="p">[]</span>        <span class="c1"># list
</span>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">movielist1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">movielist2</span><span class="p">:</span>
                    <span class="n">commonlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">commonlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1"># æ²¡æœ‰å…¬å…±å…ƒç´ ï¼Œç›¸ä¼¼åº¦ä¸º0
</span>                <span class="k">return</span> <span class="mi">0</span>
            <span class="c1"># è®¡ç®—æ¬§æ°è·ç¦»(ä½¿ç”¨åˆ—è¡¨ç”Ÿæˆå¼)
</span>            <span class="n">distance</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">pow</span><span class="p">(</span><span class="n">movielist1</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">-</span> <span class="n">movielist2</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">commonlist</span><span class="p">])</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sim</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">movielist1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person1</span><span class="p">]</span>
            <span class="n">movielist2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person2</span><span class="p">]</span>   <span class="c1"># dict
</span>            <span class="n">commonlist</span> <span class="o">=</span> <span class="p">[]</span>        <span class="c1"># list
</span>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">movielist1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">movielist2</span><span class="p">:</span>
                    <span class="n">commonlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">commonlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   <span class="c1"># æ²¡æœ‰å…¬å…±å…ƒç´ ï¼Œç›¸ä¼¼åº¦ä¸º0
</span>                <span class="k">return</span> <span class="mi">0</span>
            <span class="c1"># è®¡ç®—æ¬§æ°è·ç¦»(ä½¿ç”¨åˆ—è¡¨ç”Ÿæˆå¼)
</span>            <span class="n">distance</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">pow</span><span class="p">(</span><span class="n">movielist1</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">-</span> <span class="n">movielist2</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">commonlist</span><span class="p">])</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sim</span>

    <span class="k">def</span> <span class="nf">sim_pearson</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person1</span><span class="p">,</span> <span class="n">person2</span><span class="p">):</span>
        <span class="s">"""
        è®¡ç®—çš®å°”æ£®ç›¸å…³ç³»æ•°.   åº¦é‡ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„çº¿æ€§ç›¸å…³æ€§.
        å¦‚æœä¸€ä¸ªäººæ€»æ˜¯ç»™å‡ºæ¯”å¦ä¸€ä¸ªäººæ›´é«˜çš„åˆ†æ”¯ï¼Œä½†äºŒè€…çš„åˆ†å€¼åªå·®åŸºæœ¬ä¿æŒä¸€è‡´ï¼Œåˆ™ä»–ä»¬ä»ç„¶å­˜åœ¨å¾ˆå¥½çš„ç›¸å…³æ€§.
        :return:ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„çš®å°”æ£®ç›¸å…³ç³»æ•°ï¼Œè¿”å›æµ®ç‚¹æ•°
        """</span>
        <span class="n">movielist1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person1</span><span class="p">]</span>
        <span class="n">movielist2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person2</span><span class="p">]</span>
        <span class="n">commonlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">movielist1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">movielist2</span><span class="p">:</span>
                <span class="n">commonlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>  <span class="c1"># key
</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">commonlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># æ²¡æœ‰å…±åŒé¡¹
</span>            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">sum1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person1</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">commonlist</span><span class="p">])</span>   <span class="c1"># person1è¯„åˆ†å’Œ
</span>        <span class="n">sum2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person2</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">commonlist</span><span class="p">])</span>   <span class="c1"># person2è¯„åˆ†å’Œ
</span>
        <span class="n">sum1sq</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">pow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person1</span><span class="p">][</span><span class="n">item</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">commonlist</span><span class="p">])</span>  <span class="c1"># person1è¯„åˆ†å¹³æ–¹å’Œ
</span>        <span class="n">sum2sq</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">pow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person2</span><span class="p">][</span><span class="n">item</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">commonlist</span><span class="p">])</span>  <span class="c1"># person2è¯„åˆ†å¹³æ–¹å’Œ
</span>
        <span class="n">psum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person1</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person2</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">commonlist</span><span class="p">])</span>  <span class="c1"># äº¤å‰é¡¹ä¹˜ç§¯å’Œ
</span>
        <span class="c1"># calculate perarson
</span>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">commonlist</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">=</span> <span class="p">(</span><span class="n">psum</span> <span class="o">-</span> <span class="p">(</span><span class="n">sum1</span> <span class="o">*</span> <span class="n">sum2</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">sum1sq</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">sum1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sum2sq</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">sum2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">den</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">topMatches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="n">sim_pearson</span><span class="p">):</span>
        <span class="s">"""
        è¿”å›ä¸personæœ€ç›¸ä¼¼çš„nä¸ªäººçš„å§“åå’Œç›¸ä¼¼åº¦. ç›¸ä¼¼åº¦åº¦é‡é€‰ç”¨ çš®å°”æ£®ç›¸å…³ç³»æ•°
        :param person: è¦è®¡ç®—çš„äººçš„å§“å
        :param n: ä¸personç›¸ä¼¼åº¦æœ€é«˜çš„nä¸ªäºº
        :param similarity: ç›¸ä¼¼åº¦åº¦é‡æ–¹æ³•
        :return: è¿”å›ä¸€ä¸ªlistï¼Œlistä¸­å…ƒç»„å­˜å‚¨çš„å½¢å¼ä¸ºï¼ˆç›¸å…³æ€§, å§“åï¼‰
        """</span>
        <span class="k">if</span> <span class="n">person</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">"person input error!"</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[(</span><span class="n">similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person</span><span class="p">,</span> <span class="n">item</span><span class="p">),</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span> <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="n">person</span><span class="p">]</span>
        <span class="c1"># print scores[:]
</span>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">it</span><span class="p">:</span> <span class="o">-</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span>  <span class="c1"># å–ç›¸ä¼¼åº¦æœ€é«˜çš„nä½
</span>
    <span class="k">def</span> <span class="nf">getRecommendations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="n">sim_pearson</span><span class="p">):</span>
        <span class="s">"""
        ç”¨ä¸personçš„ç›¸ä¼¼åº¦å¯¹å…¶ä»–äººå¯¹personæœªçœ‹è¿‡çš„å½±ç‰‡è¿›è¡ŒåŠ æƒå¹³å‡ï¼Œå¯¹personæœªçœ‹å½±ç‰‡è¿›è¡ŒåŠ æƒæ‰“åˆ†
        :param person:
        :param similarity: ç›¸ä¼¼åº¦åº¦é‡æ–¹æ³•
        :return: è¿”å›å¯¹ person æœªçœ‹å½±ç‰‡çš„æ¨èè¯„åˆ†ï¼ŒæŒ‰è¯„åˆ†æ’åºè¿›è¡Œæ¨è
        """</span>
        <span class="n">moviescore_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># å½±ç‰‡--å½±ç‰‡å¯¹åº”çš„è¯„åˆ†å’Œ
</span>        <span class="n">moviesim_dict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># å½±ç‰‡--å½±ç‰‡å¯¹åº”çš„ç›¸ä¼¼åº¦å’Œ
</span>        <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">:</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="n">similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">person</span><span class="p">)</span>  <span class="c1"># äººä¹‹é—´çš„ç›¸ä¼¼åº¦
</span>            <span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="n">person</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">sim</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">other</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person</span><span class="p">]:</span>  <span class="c1"># å¦‚æœpersonæœªå¯¹è¯¥ç”µå½±è¿›è¡Œè¯„ä»·
</span>                    <span class="n">moviescore_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">moviescore_dict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">other</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="o">*</span> <span class="n">sim</span>

                    <span class="n">moviesim_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">moviesim_dict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sim</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">float</span><span class="p">(</span><span class="n">moviescore_dict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">/</span> <span class="n">moviesim_dict</span><span class="p">[</span><span class="n">item</span><span class="p">]),</span> <span class="n">item</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">moviescore_dict</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e1</span><span class="p">:</span> <span class="o">-</span><span class="n">e1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">transformPrefs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        å°†self.criticsä¸­çš„ äºº--ç”µå½± çš„é”®å’Œå€¼è¿›è¡Œè°ƒæ¢ï¼Œåå‘æ„é€ å­—å…¸
        :return: é”®å€¼è°ƒæ¢åçš„ dict
        """</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person</span><span class="p">]:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">result</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">person</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">person</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">calculateSimilarItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="n">sim_distance</span><span class="p">):</span>
        <span class="s">"""
        åˆ©ç”¨åå‘æ„é€ çš„ ç‰©å“--äºº  å­—å…¸ï¼Œæ„é€ ä¸€ä¸ªç‰©å“ç›¸ä¼¼åº¦å­—å…¸
        å­—å…¸çš„é”®æ˜¯ç‰©å“ï¼Œå€¼æ˜¯ä¸è¯¥ç‰©å“æœ€ç›¸ä¼¼çš„nä¸ªç‰©å“ä»¥åŠç‰©å“ä¹‹é—´çš„ç›¸ä¼¼åº¦
        :param n: ä¸ç‰©å“æœ€ç›¸ä¼¼çš„nä¸ªç‰©å“
        :return: dict
        """</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">reverse_critics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformPrefs</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">movie</span> <span class="ow">in</span> <span class="n">reverse_critics</span><span class="p">:</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="p">[(</span><span class="n">similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">movie</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">item</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">reverse_critics</span> <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="n">movie</span><span class="p">]</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">it</span><span class="p">:</span> <span class="o">-</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>       <span class="c1"># å–ç›¸ä¼¼åº¦æœ€é«˜çš„nä½
</span>            <span class="n">result</span><span class="p">[</span><span class="n">movie</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">getRecommendedItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="s">"""
        æŒ‡å®šä¸€ä¸ªåå­—userï¼Œè®¡ç®—å¯¹è¯¥ç”¨æˆ·çš„ç”µå½±æ¨è
        é¦–å…ˆåˆ©ç”¨ calculateSimilarItemsæ–¹æ³•è®¡ç®—ç‰©å“ä¹‹é—´çš„ç›¸ä¼¼åº¦dict
        æ ¹æ®è¯¥ç”¨æˆ·å¯¹æ›¾ç»çœ‹è¿‡çš„å½±ç‰‡çš„è¯„åˆ†ä»¥åŠè¯¥ç”µå½±ä¸æœªçœ‹è¿‡ç”µå½±çš„ç›¸ä¼¼åº¦ä¼°è®¡ç”¨æˆ·å¯¹æœªçœ‹ç”µå½±çš„è¯„åˆ†ï¼Œæ ¹æ®è¯„åˆ†è¿›è¡Œæ¨è
        :param user: æŒ‡å®šçš„äºº
        :return:
        """</span>
        <span class="n">userRatings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critics</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>  <span class="c1"># è¿”å›è¯¥ç”¨æˆ·æ‰€çœ‹ç”µå½±å’Œè¯„åˆ†
</span>        <span class="n">itemMatch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculateSimilarItems</span><span class="p">()</span>  <span class="c1"># è¿”å›ç‰©å“çš„ç›¸ä¼¼åº¦å­—å…¸
</span>        <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">totalsim</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">userRatings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">similarity</span><span class="p">,</span> <span class="n">item2</span> <span class="ow">in</span> <span class="n">itemMatch</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">item2</span> <span class="ow">in</span> <span class="n">userRatings</span><span class="p">:</span>   <span class="c1"># è‹¥è¯¥ç”µå½±è¢«ç”¨æˆ·è¯„åˆ†
</span>                    <span class="k">continue</span>
                <span class="n">scores</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">item2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">scores</span><span class="p">[</span><span class="n">item2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">similarity</span> <span class="o">*</span> <span class="n">rating</span>
                <span class="n">totalsim</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">item2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">totalsim</span><span class="p">[</span><span class="n">item2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">similarity</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="p">[(</span><span class="n">score</span> <span class="o">/</span> <span class="n">totalsim</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">scores</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">ranking</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">it</span><span class="p">:</span> <span class="o">-</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ranking</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">recommendation</span><span class="p">()</span>

    <span class="c1"># 1.æ¬§å‡ é‡Œå¾—è·ç¦»è®¡ç®—ç›¸ä¼¼åº¦
</span>    <span class="k">print</span> <span class="s">"</span><span class="se">\n</span><span class="s">æ¬§å‡ é‡Œå¾—ç›¸ä¼¼åº¦:"</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">sim_distance</span><span class="p">(</span><span class="s">'Lisa Rose'</span><span class="p">,</span> <span class="s">'Gene Seymour'</span><span class="p">)</span>

    <span class="c1"># 2.çš®å°”æ£®ç›¸å…³ç³»æ•°è®¡ç®—
</span>    <span class="k">print</span> <span class="s">"</span><span class="se">\n</span><span class="s">çš®å°”æ£®ç›¸å…³ç³»æ•°:"</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">sim_pearson</span><span class="p">(</span><span class="s">'Lisa Rose'</span><span class="p">,</span> <span class="s">'Gene Seymour'</span><span class="p">)</span>

    <span class="c1"># 3.è®¡ç®—ä¸æŸäººç›¸ä¼¼åº¦æœ€é«˜çš„nä¸ªäºº
</span>    <span class="k">print</span> <span class="s">"</span><span class="se">\n</span><span class="s">ä¸ Toby ç›¸ä¼¼åº¦æœ€é«˜çš„nä¸ªäºº"</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">topMatches</span><span class="p">(</span><span class="s">'Toby'</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)[:]</span>

    <span class="c1"># 4.è¾“å…¥äººåï¼Œå¯¹è¯¥äººæœªè§‚çœ‹çš„å½±ç‰‡æ¨è
</span>    <span class="k">print</span> <span class="s">"</span><span class="se">\n</span><span class="s">ç»™ Toby æœªè§‚çœ‹å½±ç‰‡çš„æ¨èæ˜¯"</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">getRecommendations</span><span class="p">(</span><span class="s">'Toby'</span><span class="p">)[:]</span>

    <span class="c1"># 5.æ„å»ºç‰©å“ç›¸ä¼¼åº¦å­—å…¸
</span>    <span class="k">print</span> <span class="s">"</span><span class="se">\n</span><span class="s">ç”µå½±ä¹‹é—´çš„ç›¸ä¼¼åº¦å­—å…¸æ˜¯ï¼š"</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">calculateSimilarItems</span><span class="p">()</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">print</span> <span class="n">key</span><span class="p">,</span> <span class="s">":"</span><span class="p">,</span> <span class="n">value</span><span class="p">[:]</span>

    <span class="c1"># 6.æ ¹æ®ç‰©å“ç›¸ä¼¼åº¦ï¼Œè¾“å…¥äººåï¼Œæ¨èå½±ç‰‡
</span>    <span class="k">print</span> <span class="s">"</span><span class="se">\n</span><span class="s">æ ¹æ®ç”µå½±ç›¸ä¼¼åº¦ç»™ Toby æ¨èçš„å½±ç‰‡æ˜¯ï¼š"</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">getRecommendedItems</span><span class="p">(</span><span class="s">'Toby'</span><span class="p">)[:]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å‚è€ƒèµ„æ–™ï¼šhttps://blog.csdn.net/bcj296050240/article/details/50810662</p>

<h2 id="å›å½’æ¨¡å‹">å›å½’æ¨¡å‹</h2>

<h3 id="ï¸-çº¿æ€§è§„åˆ’linear-regression">â˜£ï¸ çº¿æ€§è§„åˆ’ï¼ˆLinear Regressionï¼‰</h3>

<h3 id="-é€»è¾‘å›å½’logistic-regression">âœ… é€»è¾‘å›å½’ï¼ˆLogistic Regressionï¼‰</h3>

<p><img src="https://yuanxiaosc.github.io/2018/06/21/%E6%94%B9%E8%BF%9B%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E2%80%94%E2%80%94%E4%BA%A4%E5%8F%89%E7%86%B5/one_1.png" alt="img" /></p>

<h3 id="-softmax">âœ… SoftMax</h3>

<p><img src="https://pic1.zhimg.com/v2-11758fbc2fc5bbbc60106926625b3a4f_1200x500.jpg" style="zoom:70%" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">789</span><span class="p">])</span>    <span class="c1"># example with 3 classes and each having large scores
</span><span class="n">scores</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>    <span class="c1"># scores becomes [-666, -333, 0]
</span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ä¸»è¦ç”¨äºå¤šåˆ†ç±»å›å½’ï¼Œå¯ä»¥å¯¹å‘é‡è¿›è¡Œå¤„ç†ï¼Œæœ€åå¾—å‡ºçš„æ¦‚ç‡æ€»å’Œæ˜¯1</p>

<p>å‚è€ƒèµ„æ–™ï¼šhttps://zhuanlan.zhihu.com/p/25723112ï¼ˆsoftmaxåº”ç”¨ï¼‰</p>

<h3 id="ï¸-ä¼¼ç„¶å‡½æ•°likelihood-function">â˜£ï¸ ä¼¼ç„¶å‡½æ•°ï¼ˆLikelihood Functionï¼‰</h3>

<h3 id="ï¸-è´å¶æ–¯ç½‘ç»œbayes-network">â˜£ï¸ è´å¶æ–¯ç½‘ç»œï¼ˆBayes Networkï¼‰</h3>

<p>å‚è€ƒèµ„æ–™ï¼šhttps://cloud.tencent.com/developer/article/1102103ï¼ˆåˆ†ç±»ç®—æ³•æ€»ç»“ï¼‰</p>

<h2 id="ç»Ÿè®¡æ¨¡å‹-è’™åœˆ">ç»Ÿè®¡æ¨¡å‹-è’™åœˆ</h2>

<h3 id="ï¸-æ¡ä»¶éšæœºåœºconditional-random-field">â˜£ï¸ æ¡ä»¶éšæœºåœºï¼ˆConditional Random Fieldï¼‰</h3>

<h3 id="-é©¬å°”å¯å¤«æ¨¡å‹markov-models">âœ… é©¬å°”å¯å¤«æ¨¡å‹ï¼ˆMarkov Modelsï¼‰</h3>

<p><strong>æ¦‚è¿°</strong>ï¼šé©¬å°”å¯å¤«è¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªçŠ¶æ€ï¼Œåªä¸å‰ä¸€ä¸ªçŠ¶æ€ç›¸å…³</p>

<p><img src="https://pic4.zhimg.com/80/648a55725e67d718d97d6a475891d70b_hd.jpg" style="width:50%" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c1"># å…³ç³»çŸ©é˜µ
</span><span class="n">transfer_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">],[</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.7</span><span class="p">]],</span><span class="n">dtype</span><span class="o">=</span><span class="s">'float32'</span><span class="p">)</span> 
<span class="c1"># 
</span><span class="n">start_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.2</span><span class="p">]],</span><span class="n">dtype</span><span class="o">=</span><span class="s">'float32'</span><span class="p">)</span> 

<span class="n">value1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">value2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">value3</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
    <span class="n">start_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">start_matrix</span><span class="p">,</span><span class="n">transfer_matrix</span><span class="p">)</span>
    <span class="n">value1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">value2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">value3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">start_matrix</span><span class="p">)</span>

<span class="c1"># è¾“å‡º[[0.23076934 0.30769244 0.4615386 ]]
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="-éšé©¬å°”å¯å¤«æ¨¡å‹hidden-markov-models">ğŸ’¤ éšé©¬å°”å¯å¤«æ¨¡å‹ï¼ˆHidden Markov Modelsï¼‰</h3>

<h4 id="-å‰è¨€-1">âœ… å‰è¨€</h4>

<p>éšé©¬å°”å¯å¤«æ¨¡å‹å³é©¬å°”å¯å¤«é“¾ä¸ŠåŠ äº†ä¸€å±‚éšæœºè¿‡ç¨‹ï¼Œä¸€èˆ¬é‡‡ç”¨Baum-Welchç®—æ³•å’ŒViterbiç®—æ³•è¿›è¡Œæ±‚è§£</p>

<p><img src="https://pic2.zhimg.com/792e033ff9b0418b3b6c9bbaef30fd83_r.jpg" alt="preview" /></p>

<h4 id="-baum-welchç®—æ³•">ğŸ†˜ Baum-Welchç®—æ³•</h4>

<p>ä¸€ç§EMç®—æ³•</p>

<h4 id="-viterbiç®—æ³•">ğŸ†˜ Viterbiç®—æ³•</h4>

<h4 id="-æºç -baum-welchç®—æ³•">ğŸ†˜ æºç -Baum-Welchç®—æ³•</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
</pre></td><td class="rouge-code"><pre><span class="s">"""
éšé©¬å°”ç§‘å¤«æ¨¡å‹
ä¸‰ç±»é—®é¢˜ï¼š1.æ¦‚ç‡è®¡ç®— 2.å­¦ä¹ é—®é¢˜ï¼ˆå‚æ•°ä¼°è®¡ï¼‰ 3.é¢„æµ‹é—®é¢˜ï¼ˆçŠ¶æ€åºåˆ—çš„é¢„æµ‹ï¼‰
"""</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">accumulate</span>

<span class="k">class</span> <span class="nc">GenData</span><span class="p">:</span>
    <span class="s">"""
    æ ¹æ®éšé©¬å°”ç§‘å¤«æ¨¡å‹ç”Ÿæˆç›¸åº”çš„è§‚æµ‹æ•°æ®
    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hmm</span><span class="p">,</span> <span class="n">n_sample</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hmm</span> <span class="o">=</span> <span class="n">hmm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span> <span class="o">=</span> <span class="n">n_sample</span>

    <span class="k">def</span> <span class="nf">_locate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prob_arr</span><span class="p">):</span>
        <span class="c1"># ç»™å®šæ¦‚ç‡å‘é‡ï¼Œè¿”å›çŠ¶æ€
</span>        <span class="n">seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">cdf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">accumulate</span><span class="p">(</span><span class="n">prob_arr</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">seed</span> <span class="o">&lt;=</span> <span class="n">cdf</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">state</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># æ ¹æ®åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡ï¼Œç”Ÿæˆåˆå§‹çŠ¶æ€
</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hmm</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">state_trans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_state</span><span class="p">):</span>
        <span class="c1"># è½¬ç§»çŠ¶æ€
</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hmm</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="n">current_state</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">gen_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_state</span><span class="p">):</span>
        <span class="c1"># ç”Ÿæˆè§‚æµ‹
</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hmm</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">current_state</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">gen_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># æ ¹æ®æ¨¡å‹äº§ç”Ÿè§‚æµ‹æ•°æ®
</span>        <span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_state</span><span class="p">()</span>
        <span class="n">start_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_obs</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_state</span><span class="p">]</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_obs</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_trans</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
            <span class="n">state</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
            <span class="n">obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gen_obs</span><span class="p">(</span><span class="n">current_state</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">state</span><span class="p">,</span> <span class="n">obs</span>


<span class="k">class</span> <span class="nc">HMM</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_state</span><span class="p">,</span> <span class="n">n_obs</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_state</span> <span class="o">=</span> <span class="n">n_state</span>  <span class="c1"># çŠ¶æ€çš„ä¸ªæ•°n
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">n_obs</span> <span class="o">=</span> <span class="n">n_obs</span>  <span class="c1"># è§‚æµ‹çš„ç§ç±»æ•°m
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">S</span>  <span class="c1"># 1*n, åˆå§‹çŠ¶æ€æ¦‚ç‡å‘é‡
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">A</span>  <span class="c1"># n*n, çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span>  <span class="c1"># n*m, è§‚æµ‹ç”Ÿæˆæ¦‚ç‡çŸ©é˜µ
</span>
<span class="k">def</span> <span class="nf">_alpha</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># è®¡ç®—æ—¶åˆ»tå„ä¸ªçŠ¶æ€çš„å‰å‘æ¦‚ç‡
</span>    <span class="n">b</span> <span class="o">=</span> <span class="n">hmm</span><span class="o">.</span><span class="n">B</span><span class="p">[:,</span> <span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hmm</span><span class="o">.</span><span class="n">S</span> <span class="o">*</span> <span class="n">b</span><span class="p">])</span>  <span class="c1"># n*1
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">@</span> <span class="n">hmm</span><span class="o">.</span><span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hmm</span><span class="o">.</span><span class="n">B</span><span class="p">[:,</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]]])</span>
    <span class="k">return</span> <span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">forward_prob</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
    <span class="c1"># å‰å‘ç®—æ³•è®¡ç®—æœ€ç»ˆç”Ÿæˆè§‚æµ‹åºåˆ—çš„æ¦‚ç‡, å³å„ä¸ªçŠ¶æ€ä¸‹æ¦‚ç‡ä¹‹å’Œ
</span>    <span class="n">alpha</span> <span class="o">=</span> <span class="n">_alpha</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_beta</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># è®¡ç®—æ—¶åˆ»tå„ä¸ªçŠ¶æ€çš„åå‘æ¦‚ç‡
</span>    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">n_state</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">))):</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">A</span> <span class="o">*</span> <span class="n">hmm</span><span class="o">.</span><span class="n">B</span><span class="p">[:,</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">beta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">beta</span>

<span class="k">def</span> <span class="nf">backward_prob</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
    <span class="c1"># åå‘ç®—æ³•è®¡ç®—ç”Ÿæˆè§‚æµ‹åºåˆ—çš„æ¦‚ç‡
</span>    <span class="n">beta</span> <span class="o">=</span> <span class="n">_beta</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">S</span> <span class="o">*</span> <span class="n">hmm</span><span class="o">.</span><span class="n">B</span><span class="p">[:,</span> <span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">beta</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fb_prob</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c1"># å°†å‰å‘å’Œåå‘åˆå¹¶
</span>    <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">_alpha</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">_beta</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_gamma</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># è®¡ç®—æ—¶åˆ»tå¤„äºå„ä¸ªçŠ¶æ€çš„æ¦‚ç‡
</span>    <span class="n">alpha</span> <span class="o">=</span> <span class="n">_alpha</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">_beta</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">beta</span>
    <span class="k">return</span> <span class="n">prob</span> <span class="o">/</span> <span class="n">prob</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">point_prob</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="c1"># è®¡ç®—æ—¶åˆ»tå¤„äºçŠ¶æ€içš„æ¦‚ç‡
</span>    <span class="n">prob</span> <span class="o">=</span> <span class="n">_gamma</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prob</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_xi</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">_alpha</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
    <span class="n">beta_p</span> <span class="o">=</span> <span class="n">_beta</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">obs_prob</span> <span class="o">=</span> <span class="n">hmm</span><span class="o">.</span><span class="n">B</span><span class="p">[:,</span> <span class="n">obs</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="n">obs_beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">(</span><span class="n">obs_prob</span> <span class="o">*</span> <span class="n">beta_p</span><span class="p">)</span>
    <span class="n">alpha_obs_beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">alpha</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">obs_beta</span><span class="p">)</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">alpha_obs_beta</span> <span class="o">*</span> <span class="n">hmm</span><span class="o">.</span><span class="n">A</span>
    <span class="k">return</span> <span class="n">xi</span> <span class="o">/</span> <span class="n">xi</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">maxstep</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="c1"># åˆ©ç”¨Baum-Welchç®—æ³•å­¦ä¹ 
</span>    <span class="n">hmm</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">hmm</span><span class="o">.</span><span class="n">n_state</span><span class="p">,</span> <span class="n">hmm</span><span class="o">.</span><span class="n">n_state</span><span class="p">))</span> <span class="o">/</span> <span class="n">hmm</span><span class="o">.</span><span class="n">n_state</span>
    <span class="n">hmm</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">hmm</span><span class="o">.</span><span class="n">n_state</span><span class="p">,</span> <span class="n">hmm</span><span class="o">.</span><span class="n">n_obs</span><span class="p">))</span> <span class="o">/</span> <span class="n">hmm</span><span class="o">.</span><span class="n">n_obs</span>
    <span class="n">hmm</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">n_state</span><span class="p">)</span>  <span class="c1"># åˆå§‹çŠ¶æ€æ¦‚ç‡çŸ©é˜µï¼ˆå‘é‡ï¼‰ï¼Œçš„åˆå§‹åŒ–å¿…é¡»éšæœºçŠ¶æ€ï¼Œå¦åˆ™å®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜
</span>    <span class="n">hmm</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">hmm</span><span class="o">.</span><span class="n">S</span> <span class="o">/</span> <span class="n">hmm</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
    <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="n">maxstep</span><span class="p">:</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">B</span><span class="p">)</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">_gamma</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">tmp_gamma</span> <span class="o">=</span> <span class="n">_gamma</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">gamma</span> <span class="o">+=</span> <span class="n">tmp_gamma</span>
            <span class="n">xi</span> <span class="o">+=</span> <span class="n">_xi</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">B</span><span class="p">[:,</span> <span class="n">obs_data</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">tmp_gamma</span>

        <span class="c1"># æ›´æ–° A
</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">n_state</span><span class="p">):</span>
            <span class="n">hmm</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># æ›´æ–° B
</span>        <span class="n">tmp_gamma_end</span> <span class="o">=</span> <span class="n">_gamma</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">gamma</span> <span class="o">+=</span> <span class="n">tmp_gamma_end</span>
        <span class="n">B</span><span class="p">[:,</span> <span class="n">obs_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">tmp_gamma_end</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">n_state</span><span class="p">):</span>
            <span class="n">hmm</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># æ›´æ–° S
</span>        <span class="n">hmm</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">S</span>
        <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">hmm</span>

<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
    <span class="c1"># é‡‡ç”¨Viterbiç®—æ³•é¢„æµ‹çŠ¶æ€åºåˆ—
</span>    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">nodes_graph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">hmm</span><span class="o">.</span><span class="n">n_state</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># å­˜å‚¨æ—¶åˆ»tä¸”çŠ¶æ€ä¸ºiæ—¶ï¼Œ å‰ä¸€ä¸ªæ—¶åˆ»t-1çš„çŠ¶æ€ï¼Œç”¨äºæ„å»ºæœ€ç»ˆçš„çŠ¶æ€åºåˆ—
</span>    <span class="n">delta</span> <span class="o">=</span> <span class="n">hmm</span><span class="o">.</span><span class="n">S</span> <span class="o">*</span> <span class="n">hmm</span><span class="o">.</span><span class="n">B</span><span class="p">[:,</span> <span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># å­˜å‚¨åˆ°tæ—¶åˆ»ï¼Œä¸”æ­¤åˆ»çŠ¶æ€ä¸ºiçš„æœ€å¤§æ¦‚ç‡
</span>    <span class="n">nodes_graph</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">n_state</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="n">new_delta</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hmm</span><span class="o">.</span><span class="n">n_state</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="n">hmm</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">delta</span><span class="p">)]</span>  <span class="c1"># å½“å‰çŠ¶æ€ä¸ºiæ—¶ï¼Œ é€‰å–æœ€ä¼˜çš„å‰ä¸€æ—¶åˆ»çŠ¶æ€
</span>            <span class="n">max_d</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="n">new_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_d</span> <span class="o">*</span> <span class="n">hmm</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">obs</span><span class="p">[</span><span class="n">t</span><span class="p">]])</span>
            <span class="n">nodes_graph</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">max_d</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">new_delta</span>

    <span class="n">current_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">nodes_graph</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">N</span>
    <span class="k">while</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
        <span class="n">current_state</span> <span class="o">=</span> <span class="n">nodes_graph</span><span class="p">[</span><span class="n">current_state</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c1"># S = np.array([0.2, 0.4, 0.4])
</span>    <span class="c1"># A = np.array([[0.5, 0.2, 0.3], [0.3, 0.5, 0.2], [0.2, 0.3, 0.5]])
</span>    <span class="c1"># B = np.array([[0.5, 0.2, 0.3], [0.4, 0.2, 0.4], [0.6, 0.3, 0.1]])
</span>    <span class="c1"># hmm_real = HMM(3, 3, S, A, B)
</span>    <span class="c1"># g = GenData(hmm_real, 500)
</span>    <span class="c1"># state, obs = g.gen_data()
</span>    <span class="c1"># æ£€æµ‹ç”Ÿæˆçš„æ•°æ®
</span>    <span class="c1"># state, obs = np.array(state), np.array(obs)
</span>    <span class="c1"># ind = np.where(state==2)[0]
</span>    <span class="c1"># from collections import Counter
</span>    <span class="c1"># obs_ind = obs[ind]
</span>    <span class="c1"># c1 = Counter(obs_ind)
</span>    <span class="c1"># n = sum(c1.values())
</span>    <span class="c1"># for o, val in c.items():
</span>    <span class="c1">#     print(o, val/n)
</span>    <span class="c1"># ind_next = ind + 1
</span>    <span class="c1"># ind_out = np.where(ind_next==1000)
</span>    <span class="c1"># ind_next = np.delete(ind_next, ind_out)
</span>    <span class="c1"># state_next = state[ind_next]
</span>    <span class="c1"># c2 = Counter(state_next)
</span>    <span class="c1"># n = sum(c2.values())
</span>    <span class="c1"># for s, val in c2.items():
</span>    <span class="c1">#     print(s, val/n)
</span>
    <span class="c1"># é¢„æµ‹
</span>    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]])</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]])</span>
    <span class="n">hmm</span> <span class="o">=</span> <span class="n">HMM</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">GenData</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">state</span><span class="p">,</span> <span class="n">obs</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">gen_data</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">)])</span>
    <span class="k">print</span><span class="p">(</span><span class="n">score</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="c1"># å­¦ä¹ 
</span>    <span class="c1"># import matplotlib.pyplot as plt
</span>    <span class="c1">#
</span>    <span class="c1">#
</span>    <span class="c1"># def triangle_data(n_sample):
</span>    <span class="c1">#     # ç”Ÿæˆä¸‰è§’æ³¢å½¢çŠ¶çš„åºåˆ—
</span>    <span class="c1">#     data = []
</span>    <span class="c1">#     for x in range(n_sample):
</span>    <span class="c1">#         x = x % 6
</span>    <span class="c1">#         if x &lt;= 3:
</span>    <span class="c1">#             data.append(x)
</span>    <span class="c1">#         else:
</span>    <span class="c1">#             data.append(6 - x)
</span>    <span class="c1">#     return data
</span>    <span class="c1">#
</span>    <span class="c1">#
</span>    <span class="c1"># hmm = HMM(10, 4)
</span>    <span class="c1"># data = triangle_data(30)
</span>    <span class="c1"># hmm = fit(hmm, data)
</span>    <span class="c1"># g = GenData(hmm, 30)
</span>    <span class="c1"># state, obs = g.gen_data()
</span>    <span class="c1">#
</span>    <span class="c1"># x = [i for i in range(30)]
</span>    <span class="c1"># plt.scatter(x, obs, marker='*', color='r')
</span>    <span class="c1"># plt.plot(x, data, color='g')
</span>    <span class="c1"># plt.show()
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>å‚è€ƒèµ„æ–™ï¼šhttps://www.zhihu.com/question/20962240ï¼ˆé©¬å°”å¯å¤«ï¼‰ã€https://blog.csdn.net/slx_share/article/details/80237566ï¼ˆéšé©¬å°”å¯å¤«ï¼‰ã€https://blog.csdn.net/slx_share/article/details/80237566ï¼ˆæºç æ¡ˆä¾‹ï¼‰</p>

<h3 id="-è’™ç‰¹å¡ç½—æ–¹æ³•monte-carlo-method">ğŸ’¤ è’™ç‰¹å¡ç½—æ–¹æ³•ï¼ˆ<strong>Monte Carlo</strong> Methodï¼‰</h3>

<h4 id="-åŸºç¡€æ¨¡å‹">âœ… åŸºç¡€æ¨¡å‹</h4>

<p><strong>æ¦‚è¿°</strong>ï¼šé€šè¿‡å¤§é‡éšæœºæ ·æœ¬ï¼Œå»äº†è§£ä¸€ä¸ªç³»ç»Ÿï¼Œè¿›è€Œå¾—åˆ°æ‰€è¦è®¡ç®—çš„å€¼ã€‚å®ƒéå¸¸å¼ºå¤§å’Œçµæ´»ï¼Œåˆç›¸å½“ç®€å•æ˜“æ‡‚ï¼Œå¾ˆå®¹æ˜“å®ç°ã€‚å¯¹äºè®¸å¤šé—®é¢˜æ¥è¯´ï¼Œå®ƒå¾€å¾€æ˜¯æœ€ç®€å•çš„è®¡ç®—æ–¹æ³•ï¼Œæœ‰æ—¶ç”šè‡³æ˜¯å”¯ä¸€å¯è¡Œçš„æ–¹æ³•ã€‚</p>

<p><strong>ä¸¾ä¾‹</strong>ï¼šåœ¨åŒºåŸŸå†…éšæœºäº§ç”Ÿ10000ä¸ªç‚¹ï¼Œè½åœ¨åœ†å†…çš„ç‚¹ä¸åœ†å¤–çš„ç‚¹æ¯”ä¾‹è®¡åˆ’ï¼Œå¯ä»¥æ¨å¯¼ğ…çš„è¿‘ä¼¼å€¼</p>

<p><img src="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015072604.jpg" style="width:30%" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">random</span>
<span class="k">def</span> <span class="nf">calpai</span><span class="p">():</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1000000</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">x_neg</span><span class="p">,</span> <span class="n">x_pos</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">r</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">r</span>
    <span class="n">y_neg</span><span class="p">,</span> <span class="n">y_pos</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">r</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="n">r</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">x_neg</span><span class="p">,</span> <span class="n">x_pos</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y_neg</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">print</span> <span class="p">(</span><span class="n">count</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">*</span> <span class="mi">4</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="-inverse-cdf-æ–¹æ³•">ğŸ†˜ Inverse CDF æ–¹æ³•</h4>

<p><strong>åŸç†</strong>ï¼šç»å…¸ä¸”å¸¸è§çš„æ¨¡å‹å¦‚æŒ‡æ•°åˆ†å¸ƒã€ğ›¾ åˆ†å¸ƒã€t åˆ†å¸ƒã€F åˆ†å¸ƒã€Î² åˆ†å¸ƒã€Dirichlet åˆ†å¸ƒéƒ½æ˜¯æœ‰çš„ï¼Œå¯ä»¥æ–¹ä¾¿é‡‡æ ·ï¼Œä½†æ˜¯å¯¹äºç›¸å¯¹å¤æ‚çš„åˆ†å¸ƒï¼Œå°±éœ€è¦è®¾è®¡é‡‡æ ·ç­–ç•¥ï¼Œæ¯”å¦‚Inverse CDFï¼ˆCumulative Distribution Functionï¼‰æ–¹æ³•ï¼ŒCDFå¯ä»¥ç”±æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆPDFï¼ŒProbability Density Functionï¼‰è¿›è¡Œç§¯åˆ†å¾—åˆ°</p>

<p>editingâ€¦..</p>

<h4 id="-æ‹’ç»æ¥å—é‡‡æ ·">ğŸ†˜ æ‹’ç»æ¥å—é‡‡æ ·</h4>

<p><strong>æ¡ˆä¾‹</strong>ï¼šå‡è®¾ä½¿ç”¨ <img src="https://www.zhihu.com/equation?tex=U%280%2C1%29" alt="[å…¬å¼]" /> æ¥ä½œä¸ºâ€œproposal distributionâ€ <img src="https://www.zhihu.com/equation?tex=G" alt="[å…¬å¼]" /> ï¼Œè¿™æ · <img src="https://www.zhihu.com/equation?tex=g%28x%29%3D1%5Cforall+x%5Cin+%5B0%2C1%5D" alt="[å…¬å¼]" /> ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æ¯æ¬¡ç”Ÿæˆçš„ä¸¤ä¸ªæ ·æœ¬ <img src="https://www.zhihu.com/equation?tex=Y" alt="[å…¬å¼]" /> ä¸ <img src="https://www.zhihu.com/equation?tex=U" alt="[å…¬å¼]" /> ï¼Œå¯¹åº”ä¸‹å›¾ä¸­çŸ©å½¢å†…çš„ä¸€ç‚¹ <img src="https://www.zhihu.com/equation?tex=P%28Y%2CU%E2%88%97c%E2%88%97g%28Y%29%29" alt="[å…¬å¼]" /> ã€‚æ¥å—æ¡ä»¶ <img src="https://www.zhihu.com/equation?tex=U%5Cleqslant+f%28Y%29c%E2%88%97g%28Y%29" alt="[å…¬å¼]" /> ï¼Œå³ <img src="https://www.zhihu.com/equation?tex=U%E2%88%97c%E2%88%97g%28Y%29%5Cleqslant+f%28Y%29" alt="[å…¬å¼]" /> çš„å‡ ä½•æ„ä¹‰æ˜¯ç‚¹ <img src="https://www.zhihu.com/equation?tex=P" alt="[å…¬å¼]" /> åœ¨ <img src="https://www.zhihu.com/equation?tex=f%28x%29" alt="[å…¬å¼]" /> ä¸‹æ–¹ï¼Œä¸æ¥å— <img src="https://www.zhihu.com/equation?tex=Y" alt="[å…¬å¼]" /> çš„å‡ ä½•æ„ä¹‰æ˜¯ç‚¹ <img src="https://www.zhihu.com/equation?tex=P" alt="[å…¬å¼]" /> åœ¨ <img src="https://www.zhihu.com/equation?tex=f%28x%29" alt="[å…¬å¼]" /> çš„ä¸Šæ–¹ã€‚åœ¨ <img src="https://www.zhihu.com/equation?tex=f%28x%29" alt="[å…¬å¼]" /> ä¸‹æ–¹çš„ç‚¹(oå½¢çŠ¶)æ»¡è¶³æ¥å—æ¡ä»¶ï¼Œä¸Šæ–¹çš„ç‚¹(+å½¢çŠ¶)ä¸æ»¡è¶³æ¥å—æ¡ä»¶ã€‚</p>

<p><img src="https://pic1.zhimg.com/80/v2-ba61bc580f87754f4e35675c6ac1b23c_hd.jpg" style="width:50%" /></p>

<p><strong>ä»£ç å®ç°</strong>ï¼šå‡å¦‚æˆ‘ä»¬çš„ç›®æ ‡æ¦‚ç‡å¯†åº¦å‡½æ•°æ˜¯ <img src="https://www.zhihu.com/equation?tex=f%28x%29%3D%5Cfrac%7B%28x-0.4%29%5E%7B4%7D%7D%7B%5Cint_%7B0%7D%5E%7B1%7D%28x-0.4%29%5E%7B4%7Ddx%7D" alt="[å…¬å¼]" /> ï¼Œå¯¹æ­¤åˆ†å¸ƒç”Ÿæˆæ ·æœ¬ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s">'darkgrid'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">AceeptReject</span><span class="p">(</span><span class="n">split_val</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">c</span>
    <span class="k">global</span> <span class="n">power</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y</span><span class="o">*</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="n">math</span><span class="o">.</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">split_val</span><span class="p">,</span> <span class="n">power</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span>

<span class="n">power</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">0.4</span>  
<span class="n">sum_</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="nb">pow</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="n">power</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="n">power</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">power</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1">#æ±‚ç§¯åˆ†
</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="c1">#å¸¸æ•°å€¼c
</span><span class="n">c</span> <span class="o">=</span> <span class="mf">0.6</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="n">sum_</span>
<span class="n">cc</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="s">'--'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">'c*f(x)'</span><span class="p">)</span>
<span class="c1">#ç›®æ ‡æ¦‚ç‡å¯†åº¦å‡½æ•°çš„å€¼f(x)
</span><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="nb">pow</span><span class="p">(</span><span class="n">xi</span> <span class="o">-</span> <span class="n">t</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span><span class="o">/</span><span class="n">sum_</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">'f(x)'</span><span class="p">)</span>
<span class="c1">#é‡‡æ ·10000ä¸ªç‚¹
</span><span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span>  <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AceeptReject</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">'sampling'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://pic2.zhimg.com/80/v2-8ca3019c1c1b0a878f44f51458c5b15d_hd.jpg" alt="img" style="zoom:70%;" /></p>

<h4 id="-è‡ªé€‚åº”çš„æ‹’ç»é‡‡æ ·adaptive-rejection-sampling">ğŸ†˜ è‡ªé€‚åº”çš„æ‹’ç»é‡‡æ ·ï¼ˆAdaptive Rejection Samplingï¼‰</h4>

<p>editingâ€¦..</p>

<p>å‚è€ƒèµ„æ–™ï¼šhttp://www.ruanyifeng.com/blog/2015/07/monte-carlo-method.html è’™ç‰¹å¡æ´›ã€https://blog.csdn.net/baimafujinji/article/details/51407703 è’™ç‰¹å¡æ´›é‡‡æ ·ä¹‹æ‹’ç»é‡‡æ ·ï¼ˆReject Samplingï¼‰</p>

<h3 id="-é©¬å°”å¯å¤«é“¾è’™ç‰¹å¡æ´›markov-chain-monte-carlo">ğŸ’¤ é©¬å°”å¯å¤«é“¾è’™ç‰¹å¡æ´›ï¼ˆMarkov chain Monte Carloï¼‰</h3>

<h4 id="-èƒŒæ™¯">âœ… èƒŒæ™¯</h4>

<p><strong>åŠ¨æœºä¸€</strong></p>

<p>å‡å¦‚ä½ éœ€è¦å¯¹ä¸€ç»´éšæœºå˜é‡$X$è¿›è¡Œé‡‡æ ·ï¼Œ <img src="https://www.zhihu.com/equation?tex=X" alt="[å…¬å¼]" /> çš„æ ·æœ¬ç©ºé—´æ˜¯ <img src="https://www.zhihu.com/equation?tex=%5C%7B1%2C2%2C3%5C%7D" alt="[å…¬å¼]" /> ï¼Œä¸”æ¦‚ç‡åˆ†åˆ«æ˜¯ <img src="https://www.zhihu.com/equation?tex=%5C%7B1%2F2%2C1%2F4%2C1%2F4%5C%7D" alt="[å…¬å¼]" /> ï¼Œè¿™å¾ˆç®€å•ï¼Œåªéœ€å†™è¿™æ ·ç®€å•çš„ç¨‹åºï¼šé¦–å…ˆæ ¹æ®å„ç¦»æ•£å–å€¼çš„æ¦‚ç‡å¤§å°å¯¹ <img src="https://www.zhihu.com/equation?tex=%5B0%2C1%5D" alt="[å…¬å¼]" />åŒºé—´è¿›è¡Œç­‰æ¯”ä¾‹åˆ’åˆ†ï¼Œå¦‚åˆ’åˆ†ä¸º <img src="https://www.zhihu.com/equation?tex=%5B0%2C0.5%5D%2C%5B0%2C5%2C0.75%5D%2C%5B0.75%2C1%5D" alt="[å…¬å¼]" /> è¿™ä¸‰ä¸ªåŒºé—´ï¼Œå†é€šè¿‡è®¡ç®—æœºäº§ç”Ÿ <img src="https://www.zhihu.com/equation?tex=%5B0%2C1%5D" alt="[å…¬å¼]" /> ä¹‹é—´çš„ä¼ªéšæœºæ•°ï¼Œæ ¹æ®ä¼ªéšæœºæ•°çš„è½ç‚¹å³å¯å®Œæˆä¸€æ¬¡é‡‡æ ·ã€‚æ¥ä¸‹æ¥ï¼Œå‡å¦‚ <img src="https://www.zhihu.com/equation?tex=X" alt="[å…¬å¼]" /> æ˜¯è¿ç»­åˆ†å¸ƒçš„å‘¢ï¼Œæ¦‚ç‡å¯†åº¦æ˜¯ <img src="https://www.zhihu.com/equation?tex=f%28X%29" alt="[å…¬å¼]" /> ï¼Œé‚£è¯¥å¦‚ä½•è¿›è¡Œé‡‡æ ·å‘¢ï¼Ÿèªæ˜çš„ä½ è‚¯å®šä¼šæƒ³åˆ°ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼Œ <img src="https://www.zhihu.com/equation?tex=P%28X%3Ct%29%3D%5Cint+_%7B-%5Cinfty%7D%5E%7Bt%7Df%28x%29dx" alt="[å…¬å¼]" /> ï¼Œå³åœ¨ <img src="https://www.zhihu.com/equation?tex=%5B0%2C1%5D" alt="[å…¬å¼]" /> é—´éšæœºç”Ÿæˆä¸€ä¸ªæ•° <img src="https://www.zhihu.com/equation?tex=a" alt="[å…¬å¼]" /> ï¼Œç„¶åæ±‚ä½¿å¾—ä½¿ <img src="https://www.zhihu.com/equation?tex=P%28x%3Ct%29%3Da" alt="[å…¬å¼]" /> æˆç«‹çš„ <img src="https://www.zhihu.com/equation?tex=t" alt="[å…¬å¼]" /> ï¼Œ <img src="https://www.zhihu.com/equation?tex=t" alt="[å…¬å¼]" /> å³å¯ä»¥è§†ä½œä»è¯¥åˆ†éƒ¨ä¸­å¾—åˆ°çš„ä¸€ä¸ªé‡‡æ ·ç»“æœã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªå‰æï¼šä¸€æ˜¯æ¦‚ç‡å¯†åº¦å‡½æ•°å¯ç§¯ï¼›ç¬¬äºŒä¸ªæ˜¯ç´¯ç§¯åˆ†å¸ƒå‡½æ•°æœ‰åå‡½æ•°ã€‚å‡å¦‚æ¡ä»¶ä¸æˆç«‹æ€ä¹ˆåŠå‘¢ï¼ŸMCMCå°±ç™»åœºäº†ã€‚</p>

<p><strong>åŠ¨æœºäºŒ</strong></p>

<p>å‡å¦‚å¯¹äºé«˜ç»´éšæœºå˜é‡ï¼Œæ¯”å¦‚ <img src="https://www.zhihu.com/equation?tex=%5Cmathbb%7BR%7D%5E%7B50%7D" alt="[å…¬å¼]" /> ï¼Œè‹¥æ¯ä¸€ç»´å–100ä¸ªç‚¹ï¼Œåˆ™æ€»å…±è¦å– <img src="https://www.zhihu.com/equation?tex=10%5E%7B100%7D" alt="[å…¬å¼]" /> ï¼Œè€Œå·²çŸ¥å®‡å®™çš„åŸºæœ¬ç²’å­å¤§çº¦æœ‰ <img src="https://www.zhihu.com/equation?tex=10%5E%7B87%7D" alt="[å…¬å¼]" /> ä¸ªï¼Œå¯¹è¿ç»­çš„ä¹ŸåŒæ ·å¦‚æ­¤ã€‚å› æ­¤MCMCå¯ä»¥è§£å†³â€œç»´æ•°ç¾éš¾â€é—®é¢˜ã€‚</p>

<h4 id="-m-hé‡‡æ ·">ğŸ†˜ M-Hé‡‡æ ·</h4>

<h4 id="-gibbsé‡‡æ ·">ğŸ†˜ Gibbsé‡‡æ ·</h4>

<p>å‚è€ƒèµ„æ–™ï¼šhttps://zhuanlan.zhihu.com/p/37121528 MCMCâ€”â€”å…¶å®æ²¡å¤ªçœ‹æ‡‚</p>
:ET